<z-page zTitle="Documents">
  <div class="flex flex-col h-full min-h-0">
    <!-- Header Section -->
    <div class="space-y-6 pb-6 flex-shrink-0">
      <!-- Filter and Action Bar -->
      <div class="flex flex-col gap-4">
        <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between">
          <!-- Search on left -->
          <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-center flex-1">
            <!-- Search input -->
            <div class="relative flex-1 sm:flex-initial w-full sm:w-[300px]">
              <z-icon zType="search" class="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground" zSize="sm" />
              <input
                z-input
                type="text"
                placeholder="Search documents..."
                class="pl-9 w-full"
                [value]="searchInput()"
                (input)="onSearchInputChange($any($event.target).value)"
                (keydown)="onSearchKeyDown($event)"
              />
            </div>
          </div>
          <!-- Buttons on right -->
          <div class="flex gap-2 items-center ml-auto">
            <z-dropdown-menu>
              <z-button dropdown-trigger zType="default" zSize="default" class="gap-2">
                <z-icon zType="plus" zSize="sm" />
                <span>Add Document</span>
                <z-icon zType="chevron-down" zSize="sm" class="ml-1" />
              </z-button>
              @for (option of documentTypeOptions; track option.value) {
                <z-dropdown-menu-item (click)="onAddDocument(option.value)">
                  <span>{{ option.label }}</span>
                </z-dropdown-menu-item>
              }
            </z-dropdown-menu>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs Section -->
    <div class="flex-1 min-h-0 flex flex-col">
      <z-tab-group zTabsPosition="top" zActivePosition="bottom" class="flex flex-col flex-1 min-h-0">
        <!-- Document Tab -->
        <z-tab label="Document">
          <div class="flex flex-col h-full min-h-0 pt-4">
            <!-- Data Table -->
            <div class="flex-1 min-h-0">
              @if (isLoading()) {
                <div class="flex items-center justify-center h-full">
                  <div class="text-muted-foreground">Loading...</div>
                </div>
              } @else if (!hasData()) {
                <z-empty
                  zTitle="No documents found"
                  zDescription="Get started by creating a new document."
                >
                  <z-dropdown-menu>
                    <z-button dropdown-trigger zType="default" class="gap-2">
                      <z-icon zType="plus" zSize="sm" />
                      <span>Add Document</span>
                      <z-icon zType="chevron-down" zSize="sm" class="ml-1" />
                    </z-button>
                    @for (option of documentTypeOptions; track option.value) {
                      <z-dropdown-menu-item (click)="onAddDocument(option.value)">
                        <span>{{ option.label }}</span>
                      </z-dropdown-menu-item>
                    }
                  </z-dropdown-menu>
                </z-empty>
              } @else {
                <z-datatable
                  [zColumns]="columns"
                  [zData]="documents()"
                  [zViewMode]="'list'"
                  [zSelectable]="true"
                  [zSelectedRows]="selectedRows()"
                  (zSelectionChange)="onRowSelect($event)"
                >
                  <ng-template #nameCell let-row>
                    <div class="flex items-center gap-3">
                      <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-muted">
                        <z-icon zType="file-text" zSize="sm" class="text-muted-foreground" />
                      </div>
                      <div class="flex flex-col">
                        <span class="text-sm font-medium">{{ row.name || 'Untitled Document' }}</span>
                      </div>
                    </div>
                  </ng-template>

                  <ng-template #typeCell let-row>
                    <span class="text-sm text-muted-foreground">
                      {{ getDocumentTypeLabel(row.type) || '-' }}
                    </span>
                  </ng-template>

                  <ng-template #createdAtCell let-row>
                    <span class="text-sm text-muted-foreground">
                      {{ formatDate(row.createdOn) }}
                    </span>
                  </ng-template>

                  <ng-template #updatedAtCell let-row>
                    <span class="text-sm text-muted-foreground">
                      {{ formatDate(row.lastModifiedOn) }}
                    </span>
                  </ng-template>

                  <ng-template #actionsCell let-row>
                    <div class="flex items-center gap-2">
                      <z-button
                        zType="ghost"
                        zSize="icon"
                        (click)="onEdit(row)"
                        [attr.aria-label]="'Edit document'"
                      >
                        <z-icon zType="pencil" zSize="sm" />
                      </z-button>
                      <z-button
                        zType="ghost"
                        zSize="icon"
                        (click)="onGeneratePdf(row)"
                        [disabled]="isGeneratingPdf()"
                        [attr.aria-label]="'Generate PDF'"
                      >
                        <z-icon zType="file-text" zSize="sm" />
                      </z-button>
                      <z-button
                        zType="ghost"
                        zSize="icon"
                        (click)="onDelete(row.id)"
                        [attr.aria-label]="'Delete document'"
                      >
                        <z-icon zType="x" zSize="sm" class="text-destructive" />
                      </z-button>
                    </div>
                  </ng-template>
                </z-datatable>
              }
            </div>

            <!-- Pagination Footer -->
            @if (hasData()) {
              <z-datatable-pagination
                [zCurrentPage]="currentPage()"
                [zTotalPages]="totalPages()"
                [zPageSize]="pageSize()"
                [zPageSizeOptions]="pageSizeOptions()"
                [zShow]="hasData()"
                (zPageChange)="onPageChange($event)"
                (zPageSizeChange)="onPageSizeChange($event)"
              />
            }
          </div>
        </z-tab>

        <!-- Template Tab -->
        <z-tab label="Template">
          <div class="flex flex-col h-full min-h-0 pt-4">
            @if (isLoadingTemplates()) {
              <div class="flex items-center justify-center h-full">
                <div class="text-muted-foreground">Loading templates...</div>
              </div>
            } @else if (!hasTemplates()) {
              <z-empty
                zTitle="No templates found"
                zDescription="Templates will appear here once created."
              />
            } @else {
              <!-- Filter Section -->
              <div class="flex items-center gap-4 pb-4 flex-shrink-0">
                <div class="w-[200px]">
                  <z-select
                    [zValue]="selectedTemplateType()"
                    zPlaceholder="Filter by type"
                    (zSelectionChange)="onTemplateTypeFilterChange($event)"
                  >
                    @for (option of templateTypeFilterOptions; track option.value) {
                      <z-select-item [zValue]="option.value">
                        {{ option.label }}
                      </z-select-item>
                    }
                  </z-select>
                </div>
              </div>

              <div class="flex-1 min-h-0 overflow-y-auto">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pb-4">
                  @for (template of filteredTemplates(); track template.id) {
                    <z-card class="hover:shadow-md transition-shadow cursor-pointer group" (click)="onCreateFromTemplate(template)">
                      <div class="flex flex-col items-center gap-3 p-4">
                        <!-- Document Icon -->
                        <div class="flex items-center justify-center w-16 h-16 rounded-lg bg-muted group-hover:bg-muted/80 transition-colors">
                          <z-icon zType="file-text" zSize="lg" class="text-muted-foreground" />
                        </div>
                        
                        <!-- Template Info -->
                        <div class="flex flex-col items-center gap-1 text-center w-full">
                          <span class="text-xs text-muted-foreground">{{ getCategoryFromType(template.type) }}</span>
                          <span class="text-sm font-medium">{{ template.name }}</span>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex items-center gap-2 w-full justify-center pt-2" (click)="$event.stopPropagation()">
                          <z-button
                            zType="default"
                            zSize="sm"
                            (click)="onShowExample(template)"
                            [disabled]="isGeneratingPdf()"
                            [attr.aria-label]="'Generate PDF'"
                            class="w-full"
                          >
                            <z-icon zType="file-text" zSize="sm" />
                            <span class="hidden sm:inline">PDF Example</span>
                          </z-button>
                        </div>
                      </div>
                    </z-card>
                  }
                </div>
              </div>
            }
          </div>
        </z-tab>
      </z-tab-group>
    </div>
  </div>
</z-page>

