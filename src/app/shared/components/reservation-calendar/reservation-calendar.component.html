<div [class]="classes()">
  <!-- Calendar Section -->
  <div class="space-y-4">
    <!-- Calendar Header -->
    <div class="flex items-center justify-center gap-4">
      <z-button zType="ghost" zSize="sm" type="button" (click)="previousMonth($event)">
        <z-icon zType="chevron-left" />
      </z-button>
      <h3 class="text-lg font-semibold">{{ monthYearDisplay() }}</h3>
      <z-button zType="ghost" zSize="sm" type="button" (click)="nextMonth($event)">
        <z-icon zType="chevron-right" />
      </z-button>
    </div>

    <!-- Weekdays Header -->
    <div class="grid grid-cols-7 gap-0 text-center text-sm font-medium text-muted-foreground">
      @for (weekday of weekdays; track $index) {
        <div class="p-2">{{ weekday }}</div>
      }
    </div>

    <!-- Calendar Grid -->
    <div class="grid grid-cols-7 gap-0">
      @for (day of calendarDays(); track day.date.getTime()) {
        <div class="aspect-square p-1">
          <div [class]="getDayContainerClasses(day)" [class.opacity-50]="!day.isCurrentMonth">
            <span class="relative z-10">{{ day.date.getDate() }}</span>
            @if (hasBothCheckinCheckout(day)) {
              <!-- Show both overlays when date is both checkout and checkin -->
              <div [class]="getSplitOverlayClasses(day, 'checkout')" [style.clip-path]="getSplitClipPath(day, 'checkout')"></div>
              <div [class]="getSplitOverlayClasses(day, 'checkin')" [style.clip-path]="getSplitClipPath(day, 'checkin')"></div>
            } @else if (day.status === 'checkin' || day.status === 'checkout') {
              <div [class]="getSplitOverlayClasses(day, day.status === 'checkin' ? 'checkin' : 'checkout')" [style.clip-path]="getSplitClipPath(day, day.status === 'checkin' ? 'checkin' : 'checkout')"></div>
            }
            @if (hasDot(day)) {
              <span class="absolute top-1 right-1 w-1 h-1 bg-white rounded-full z-10"></span>
            }
          </div>
        </div>
      }
    </div>

    <!-- Legend -->
    <div class="flex items-center gap-4 text-xs text-muted-foreground">
      <div class="flex items-center gap-2">
        <div class="w-4 h-4 bg-green-600 rounded"></div>
        <span>Available</span>
      </div>
      <div class="flex items-center gap-2">
        <div class="w-4 h-4 bg-yellow-500 rounded"></div>
        <span>Pending</span>
      </div>
      <div class="flex items-center gap-2">
        <div class="w-4 h-4 bg-red-600 rounded"></div>
        <span>Reserved</span>
      </div>
    </div>
  </div>

  <!-- Reservations List -->
  <div class="mt-6 space-y-4">
    <div class="flex items-center justify-between">
      <h3 class="text-lg font-semibold">reservations</h3>
      <div class="flex items-center gap-2">
        <span class="text-sm text-muted-foreground">{{ activeReservations().length }} reservation{{ activeReservations().length !== 1 ? 's' : '' }}</span>
        <z-button zType="outline" zSize="sm" (click)="printCalendar()" class="gap-2">
          <z-icon zType="printer" zSize="sm" />
          Print
        </z-button>
      </div>
    </div>

    @if (activeReservations().length > 0) {
      <div class="space-y-3">
        @for (reservation of activeReservations(); track reservation.id) {
          <z-card class="p-4" zBodySpacing="none">
            <div class="space-y-3">
              <!-- Tenant Information -->
              <div class="flex items-start gap-3">
                @if (reservation.contactAvatarUrl) {
                  <img
                    [src]="reservation.contactAvatarUrl"
                    [alt]="reservation.contactName"
                    class="w-12 h-12 rounded-full object-cover border border-border flex-shrink-0"
                  />
                } @else {
                  <z-avatar
                    [zImage]="{ fallback: getTenantInitials(reservation) }"
                    zType="default"
                    zSize="lg"
                    zShape="circle"
                    class="w-12 h-12 flex-shrink-0"
                  />
                }
                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2 mb-1">
                    <span class="text-sm font-semibold">{{ reservation.contactName || 'Unnamed tenant' }}</span>
                  </div>
                  <div class="text-sm text-muted-foreground uppercase">
                    {{ formatDateRange(reservation.startDate, reservation.endDate) }}
                  </div>
                </div>
                <z-badge [zType]="getStatusBadgeType(reservation.status)" class="ml-auto">
                  {{ getStatusLabel(reservation.status) }}
                </z-badge>
              </div>

              <!-- Reservation Details -->
              <div class="grid grid-cols-2 gap-4 pt-3 border-t border-border">
                <div class="space-y-3">
                  <div>
                    <div class="text-xs text-muted-foreground mb-1 uppercase">START DATE</div>
                    <div class="text-sm font-medium">{{ formatDate(reservation.startDate) }}</div>
                  </div>
                  <div>
                    <div class="text-xs text-muted-foreground mb-1 uppercase">AMOUNT</div>
                    <div class="text-sm font-medium">{{ formatAmount(reservation.totalAmount) }}</div>
                  </div>
                </div>
                <div class="space-y-3">
                  <div>
                    <div class="text-xs text-muted-foreground mb-1 uppercase">END DATE</div>
                    <div class="text-sm font-medium">{{ formatDate(reservation.endDate) }}</div>
                  </div>
                  <div>
                    <div class="text-xs text-muted-foreground mb-1 uppercase">DURATION</div>
                    <div class="text-sm font-medium">{{ getNights(reservation) }} night{{ getNights(reservation) !== 1 ? 's' : '' }}</div>
                  </div>
                  @if (reservation.contactPhone) {
                    <div>
                      <div class="text-xs text-muted-foreground mb-1 uppercase">PHONE</div>
                      <div class="text-sm font-medium">{{ reservation.contactPhone }}</div>
                    </div>
                  }
                </div>
              </div>
            </div>
          </z-card>
        }
      </div>
    } @else {
      <div class="text-center py-8 text-sm text-muted-foreground">
        No reservations found
      </div>
    }
  </div>
</div>

