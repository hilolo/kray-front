<!-- Image Viewer Modal -->
@if (isOpen()) {
  <div class="image-viewer-overlay" (click)="closeViewer()">
    <div class="image-viewer-modal" (click)="$event.stopPropagation()">
      <!-- Action Buttons -->
      <div class="action-buttons">
        <z-button
          zType="ghost"
          zSize="icon"
          class="download-button"
          (click)="downloadImage()"
          [attr.aria-label]="'Download image'"
        >
          <z-icon zType="download" />
        </z-button>
        
        <z-button
          zType="ghost"
          zSize="icon"
          class="close-button"
          (click)="closeViewer()"
          [attr.aria-label]="'Close image viewer'"
        >
          <z-icon zType="x" />
        </z-button>
      </div>

      <!-- Mobile: Horizontal scrollable gallery -->
      <div class="md:hidden image-content-mobile">
        <div class="flex overflow-x-auto snap-x snap-mandatory scrollbar-hide h-full w-full" style="scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch;">
          @for (image of allImages(); track image.url; let i = $index) {
            <div class="flex-shrink-0 w-full h-full snap-center relative flex items-center justify-center">
              <img 
                [src]="image.url" 
                [alt]="image.name || 'Image ' + (i + 1)" 
                class="max-w-full max-h-full object-contain"
              />
            </div>
          }
        </div>
      </div>

      <!-- Desktop: Single image with navigation buttons -->
      <!-- Navigation Buttons (Desktop only) -->
      @if (hasMultipleImages()) {
        <div class="hidden md:flex navigation-buttons">
          <z-button
            zType="ghost"
            zSize="icon"
            class="nav-button prev-button"
            (click)="goToPrevious($event)"
            [attr.aria-label]="'Previous image'"
          >
            <z-icon zType="chevron-left" />
          </z-button>
          
          <z-button
            zType="ghost"
            zSize="icon"
            class="nav-button next-button"
            (click)="goToNext($event)"
            [attr.aria-label]="'Next image'"
          >
            <z-icon zType="chevron-right" />
          </z-button>
        </div>
      }

      <!-- Image Info (Desktop only) -->
      @if (currentImageName() || formattedFileSize() || imageCounter()) {
        <div class="hidden md:block image-info">
          @if (currentImageName()) {
            <div class="image-name">{{ currentImageName() }}</div>
          }
          @if (formattedFileSize()) {
            <div class="file-size">{{ formattedFileSize() }}</div>
          }
          @if (imageCounter()) {
            <div class="image-counter">{{ imageCounter() }}</div>
          }
        </div>
      }

      <!-- Image Content (Desktop only) -->
      <div 
        class="hidden md:flex image-content desktop-image-content"
        (touchstart)="onTouchStart($event)"
        (touchend)="onTouchEnd($event)"
      >
        <img
          [src]="currentImageUrl()"
          [alt]="currentImageName() || 'Full size image'"
          class="full-size-image">
      </div>
    </div>
  </div>
}
