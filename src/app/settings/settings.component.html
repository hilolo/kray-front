<z-page [zTitle]="'settings.title' | translate">
  <div class="p-6">
    <div class="flex gap-4">
      <!-- Settings Navigation -->
      <div class="w-64 flex-shrink-0">
        <h2 class="text-lg font-semibold mb-4">{{ 'settings.title' | translate }}</h2>
        <div class="space-y-0.5">
          <button type="button" (click)="activeSection.set('account')"
            [class]="activeSection() === 'account' ? 'bg-primary text-primary-foreground' : 'hover:bg-accent'"
            class="w-full flex items-center gap-2 px-3 py-2 rounded-md transition-colors text-left">
            <z-icon zType="user" zSize="default" />
            <div class="flex-1 min-w-0">
              <div class="text-sm font-medium truncate">{{ 'settings.navigation.account' | translate }}</div>
              <div class="text-xs opacity-80 line-clamp-2">{{ 'settings.navigation.accountDescription' | translate }}</div>
            </div>
          </button>

          <button type="button" (click)="activeSection.set('security')"
            [class]="activeSection() === 'security' ? 'bg-primary text-primary-foreground' : 'hover:bg-accent'"
            class="w-full flex items-center gap-2 px-3 py-2 rounded-md transition-colors text-left">
            <z-icon zType="lock" zSize="default" />
            <div class="flex-1 min-w-0">
              <div class="text-sm font-medium truncate">{{ 'settings.navigation.security' | translate }}</div>
              <div class="text-xs opacity-80 line-clamp-2">{{ 'settings.navigation.securityDescription' | translate }}</div>
            </div>
          </button>

          <button type="button" (click)="activeSection.set('team')"
            [class]="activeSection() === 'team' ? 'bg-primary text-primary-foreground' : 'hover:bg-accent'"
            class="w-full flex items-center gap-2 px-3 py-2 rounded-md transition-colors text-left">
            <z-icon zType="users" zSize="default" />
            <div class="flex-1 min-w-0">
              <div class="text-sm font-medium truncate">{{ 'settings.navigation.team' | translate }}</div>
              <div class="text-xs opacity-80 line-clamp-2">{{ 'settings.navigation.teamDescription' | translate }}</div>
            </div>
          </button>

          <button type="button" (click)="activeSection.set('application')"
            [class]="activeSection() === 'application' ? 'bg-primary text-primary-foreground' : 'hover:bg-accent'"
            class="w-full flex items-center gap-2 px-3 py-2 rounded-md transition-colors text-left">
            <z-icon zType="settings" zSize="default" />
            <div class="flex-1 min-w-0">
              <div class="text-sm font-medium truncate">{{ 'settings.navigation.application' | translate }}</div>
              <div class="text-xs opacity-80 line-clamp-2">{{ 'settings.navigation.applicationDescription' | translate }}</div>
            </div>
          </button>
        </div>
      </div>

      <!-- Settings Content -->
      <div class="flex-1">
        <!-- Icon Templates -->
        <ng-template #userIconTemplate>
          <z-icon zType="user" zSize="sm" class="text-muted-foreground" />
        </ng-template>
        <ng-template #phoneIconTemplate>
          <z-icon zType="smartphone" zSize="sm" class="text-muted-foreground" />
        </ng-template>
        <ng-template #buildingIconTemplate>
          <z-icon zType="building" zSize="sm" class="text-muted-foreground" />
        </ng-template>
        <ng-template #building2IconTemplate>
          <z-icon zType="building-2" zSize="sm" class="text-muted-foreground" />
        </ng-template>
        <ng-template #mapPinIconTemplate>
          <z-icon zType="map-pin" zSize="sm" class="text-muted-foreground" />
        </ng-template>
        <ng-template #globeIconTemplate>
          <z-icon zType="globe" zSize="sm" class="text-muted-foreground" />
        </ng-template>
        <ng-template #lockIconTemplate>
          <z-icon zType="lock" zSize="sm" class="text-muted-foreground" />
        </ng-template>

        @switch (activeSection()) {
        @case ('account') {
        <div class="space-y-8">
          <h1 class="text-3xl font-bold">{{ 'settings.account.title' | translate }}</h1>

          <!-- User Information -->
          <z-card [zTitle]="'settings.account.userInformation.title' | translate" [zDescription]="'settings.account.userInformation.description' | translate">
            <div class="flex gap-6">
              <!-- Profile Picture -->
              <div class="flex-shrink-0">
                <div class="relative">
                  @if (profileImageUrl()) {
                  <img [src]="profileImageUrl()" alt="Profile picture"
                    class="w-40 h-40 rounded-lg object-cover border border-border" />
                  } @else {
                  <div
                    class="w-40 h-40 rounded-lg bg-primary text-primary-foreground flex items-center justify-center text-4xl font-semibold border border-border">
                    {{ userInfo.fullName() ? userInfo.fullName().charAt(0).toUpperCase() : 'U' }}
                  </div>
                  }
                  <button type="button" (click)="onImageClick()"
                    class="absolute -bottom-1 -right-1 bg-primary text-primary-foreground rounded-full p-2 hover:bg-primary/90 transition-colors"
                    [title]="'settings.account.userInformation.changeProfilePicture' | translate">
                    <z-icon zType="camera" zSize="sm" />
                  </button>
                  <input #fileInput type="file" accept="image/*" (change)="onFileSelected($event)" class="hidden" />
                </div>
              </div>

              <!-- Form Fields -->
              <div class="flex-1 space-y-4">
                <z-form-field>
                  <z-form-label zRequired>{{ 'settings.account.userInformation.fullName' | translate }}</z-form-label>
                  <z-form-control [errorMessage]="fullNameError()">
                    <z-input-group [zPrefix]="userIconTemplate">
                      <input z-input type="text" [ngModel]="userInfo.fullName()"
                        (ngModelChange)="userInfo.fullName.set($event)" name="fullName"
                        [placeholder]="'settings.account.userInformation.enterFullName' | translate" [zStatus]="fullNameHasError() ? 'error' : undefined"
                        class="w-full" />
                    </z-input-group>
                  </z-form-control>
                </z-form-field>

                <z-form-field>
                  <z-form-label>{{ 'settings.account.userInformation.phone' | translate }}</z-form-label>
                  <z-form-control>
                    <z-input-group [zPrefix]="phoneIconTemplate">
                      <input z-input type="tel" [ngModel]="userInfo.phone()"
                        (ngModelChange)="userInfo.phone.set($event)" name="phone" [placeholder]="'settings.account.userInformation.enterPhoneNumber' | translate"
                        class="w-full" />
                    </z-input-group>
                  </z-form-control>
                </z-form-field>

                <!-- Action Buttons -->
                <div class="flex gap-3 justify-end pt-2">
                  <z-button zType="outline" [disabled]="isSaving()"
                    (click)="!isSaving() && onCancel()">{{ 'common.cancel' | translate }}</z-button>
                  <z-button [zType]="isSaving() || !isAccountFormValid() ? 'ghost' : 'default'" [disabled]="isSaving()"
                    (click)="!isSaving() && onSaveUserInfo()">
                    @if (isSaving()) {
                    <span class="flex items-center gap-2">
                      <z-icon zType="loader-circle" zSize="sm" class="animate-spin" />
                      {{ 'settings.account.userInformation.saving' | translate }}
                    </span>
                    } @else {
                    {{ 'settings.account.userInformation.saveUserInfo' | translate }}
                    }
                  </z-button>
                </div>
              </div>
            </div>
          </z-card>

          <!-- Company Information -->
          <z-card [zTitle]="'settings.account.companyInformation.title' | translate"
            [zDescription]="'settings.account.companyInformation.description' | translate">
            <div class="flex gap-6">
              <!-- Company Logo -->
              <div class="flex-shrink-0">
                @if (companyInfo.image) {
                  <div class="w-40 h-40 border border-border rounded-lg overflow-hidden bg-muted flex items-center justify-center">
                    <img 
                      [src]="getCompanyImageUrl()" 
                      [alt]="companyInfo.name || ('settings.account.companyInformation.companyLogo' | translate)"
                      class="w-full h-full object-contain"
                    />
                  </div>
                } @else {
                  <div class="w-40 h-40 border border-border rounded-lg flex items-center justify-center bg-muted">
                    <z-icon zType="file" zSize="lg" class="text-muted-foreground" />
                  </div>
                }
              </div>

              <!-- Read-only Fields -->
              <div class="flex-1 min-w-0">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <z-form-field>
                    <z-form-label>{{ 'settings.account.companyInformation.companyName' | translate }}</z-form-label>
                    <z-form-control>
                      <z-input-group [zPrefix]="buildingIconTemplate">
                        <input z-input type="text" [value]="companyInfo.name" disabled class="w-full truncate" />
                      </z-input-group>
                    </z-form-control>
                  </z-form-field>

                  <z-form-field>
                    <z-form-label>{{ 'settings.account.companyInformation.address' | translate }}</z-form-label>
                    <z-form-control>
                      <z-input-group [zPrefix]="mapPinIconTemplate">
                        <input z-input type="text" [value]="companyInfo.address" disabled class="w-full truncate" />
                      </z-input-group>
                    </z-form-control>
                  </z-form-field>

                  <z-form-field>
                    <z-form-label>{{ 'settings.account.companyInformation.city' | translate }}</z-form-label>
                    <z-form-control>
                      <z-input-group [zPrefix]="building2IconTemplate">
                        <input z-input type="text" [value]="companyInfo.city" disabled class="w-full truncate" />
                      </z-input-group>
                    </z-form-control>
                  </z-form-field>

                  <z-form-field>
                    <z-form-label>{{ 'settings.account.companyInformation.phone' | translate }}</z-form-label>
                    <z-form-control>
                      <z-input-group [zPrefix]="phoneIconTemplate">
                        <input z-input type="tel" [value]="companyInfo.phone" disabled class="w-full truncate" />
                      </z-input-group>
                    </z-form-control>
                  </z-form-field>

                  <z-form-field>
                    <z-form-label>{{ 'settings.account.companyInformation.website' | translate }}</z-form-label>
                    <z-form-control>
                      <z-input-group [zPrefix]="globeIconTemplate">
                        <input z-input type="url" [value]="companyInfo.website" disabled class="w-full truncate" />
                      </z-input-group>
                    </z-form-control>
                  </z-form-field>

                  <z-form-field>
                    <z-form-label>{{ 'settings.account.companyInformation.rc' | translate }}</z-form-label>
                    <z-form-control>
                      <input z-input type="text" [value]="companyInfo.rc" disabled class="w-full truncate" />
                    </z-form-control>
                  </z-form-field>

                  <z-form-field>
                    <z-form-label>{{ 'settings.account.companyInformation.ice' | translate }}</z-form-label>
                    <z-form-control>
                      <input z-input type="text" [value]="companyInfo.ice" disabled class="w-full truncate" />
                    </z-form-control>
                  </z-form-field>
                </div>
              </div>
            </div>
          </z-card>
        </div>
        }

        @case ('security') {
        <div class="space-y-8">
          <h1 class="text-3xl font-bold">{{ 'settings.security.title' | translate }}</h1>

          <z-card [zTitle]="'settings.security.changePassword.title' | translate" [zDescription]="'settings.security.changePassword.description' | translate">
            <div class="space-y-4">
              <z-form-field>
                <z-form-label zRequired>{{ 'settings.security.changePassword.currentPassword' | translate }}</z-form-label>
                <z-form-control [errorMessage]="currentPasswordError()">
                  <div class="relative">
                    <z-input-group [zPrefix]="lockIconTemplate">
                      <input z-input [type]="showCurrentPassword() ? 'text' : 'password'"
                        [ngModel]="passwordForm.currentPassword()"
                        (ngModelChange)="passwordForm.currentPassword.set($event)" name="currentPassword"
                        [placeholder]="'settings.security.changePassword.enterCurrentPassword' | translate"
                        [zStatus]="currentPasswordHasError() ? 'error' : undefined" class="w-full pr-10" />
                    </z-input-group>
                    <button type="button" (click)="toggleCurrentPassword()"
                      class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors"
                      [attr.aria-label]="showCurrentPassword() ? ('settings.security.changePassword.hidePassword' | translate) : ('settings.security.changePassword.showPassword' | translate)">
                      @if (showCurrentPassword()) {
                      <z-icon zType="eye-off" zSize="sm" />
                      } @else {
                      <z-icon zType="eye" zSize="sm" />
                      }
                    </button>
                  </div>
                </z-form-control>
              </z-form-field>

              <z-form-field>
                <z-form-label zRequired>{{ 'settings.security.changePassword.newPassword' | translate }}</z-form-label>
                <z-form-control [errorMessage]="newPasswordError()">
                  <div class="relative">
                    <z-input-group [zPrefix]="lockIconTemplate">
                      <input z-input [type]="showNewPassword() ? 'text' : 'password'"
                        [ngModel]="passwordForm.newPassword()" (ngModelChange)="passwordForm.newPassword.set($event)"
                        name="newPassword" [placeholder]="'settings.security.changePassword.enterNewPassword' | translate"
                        [zStatus]="newPasswordHasError() ? 'error' : undefined" class="w-full pr-10" />
                    </z-input-group>
                    <button type="button" (click)="toggleNewPassword()"
                      class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors"
                      [attr.aria-label]="showNewPassword() ? ('settings.security.changePassword.hidePassword' | translate) : ('settings.security.changePassword.showPassword' | translate)">
                      @if (showNewPassword()) {
                      <z-icon zType="eye-off" zSize="sm" />
                      } @else {
                      <z-icon zType="eye" zSize="sm" />
                      }
                    </button>
                  </div>
                </z-form-control>
              </z-form-field>

              <z-form-field>
                <z-form-label zRequired>{{ 'settings.security.changePassword.confirmPassword' | translate }}</z-form-label>
                <z-form-control [errorMessage]="confirmPasswordError()">
                  <div class="relative">
                    <z-input-group [zPrefix]="lockIconTemplate">
                      <input z-input [type]="showConfirmPassword() ? 'text' : 'password'"
                        [ngModel]="passwordForm.confirmPassword()"
                        (ngModelChange)="passwordForm.confirmPassword.set($event)" name="confirmPassword"
                        [placeholder]="'settings.security.changePassword.confirmNewPassword' | translate"
                        [zStatus]="confirmPasswordHasError() ? 'error' : undefined" class="w-full pr-10" />
                    </z-input-group>
                    <button type="button" (click)="toggleConfirmPassword()"
                      class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors"
                      [attr.aria-label]="showConfirmPassword() ? ('settings.security.changePassword.hidePassword' | translate) : ('settings.security.changePassword.showPassword' | translate)">
                      @if (showConfirmPassword()) {
                      <z-icon zType="eye-off" zSize="sm" />
                      } @else {
                      <z-icon zType="eye" zSize="sm" />
                      }
                    </button>
                  </div>
                </z-form-control>
              </z-form-field>

              <div class="flex gap-3 justify-end pt-2">
                <z-button [zType]="isUpdatingPassword() || !isPasswordFormValid() ? 'ghost' : 'default'"
                  [disabled]="isUpdatingPassword()" (click)="!isUpdatingPassword() && onSavePassword()">
                  @if (isUpdatingPassword()) {
                  <span class="flex items-center gap-2">
                    <z-icon zType="loader-circle" zSize="sm" class="animate-spin" />
                    {{ 'settings.security.changePassword.updating' | translate }}
                  </span>
                  } @else {
                  {{ 'settings.security.changePassword.savePassword' | translate }}
                  }
                </z-button>
              </div>
            </div>
          </z-card>
        </div>
        }

        @case ('team') {
        <div class="space-y-8">
          <div>
            <h1 class="text-3xl font-bold">{{ 'settings.team.title' | translate }}</h1>
            <h2 class="text-xl font-semibold mt-2">{{ 'settings.team.teamMembers' | translate }}</h2>
            <p class="text-muted-foreground mt-1">{{ 'settings.team.manageTeamMembers' | translate }}</p>
          </div>

          <!-- Invite Team Member -->
          <z-card [zTitle]="'settings.team.inviteTeamMember.title' | translate" [zDescription]="'settings.team.inviteTeamMember.description' | translate">
            <div class="flex items-end gap-4">
              <div class="flex-1">
                <z-form-field>
                  <z-form-label zRequired>{{ 'settings.team.inviteTeamMember.emailAddress' | translate }}</z-form-label>
                  <z-form-control [errorMessage]="invitationEmailError()">
                    <z-input-group [zPrefix]="userIconTemplate">
                      <input z-input type="email" [ngModel]="invitationForm.email()"
                        (ngModelChange)="invitationForm.email.set($event)" [placeholder]="'settings.team.inviteTeamMember.mailPlaceholder' | translate"
                        [zStatus]="invitationEmailHasError() ? 'error' : undefined" class="w-full" />
                    </z-input-group>
                  </z-form-control>
                </z-form-field>
              </div>
              <div class="w-48">
                <z-form-field>
                  <z-form-label zRequired>{{ 'settings.team.inviteTeamMember.role' | translate }}</z-form-label>
                  <z-form-control>
                    <z-select [zValue]="invitationForm.role()" [zLabel]="invitationForm.role()"
                      (zSelectionChange)="invitationForm.role.set($event)" class="w-full">
                      <z-select-item zValue="User">{{ 'settings.team.inviteTeamMember.user' | translate }}</z-select-item>
                      <z-select-item zValue="Admin">{{ 'settings.team.inviteTeamMember.admin' | translate }}</z-select-item>
                    </z-select>
                  </z-form-control>
                </z-form-field>
              </div>
              <div>
                <z-button [zType]="isInviting() || !isInvitationFormValid() ? 'ghost' : 'default'"
                  [disabled]="isInviting()" (click)="!isInviting() && inviteMember()">
                  @if (isInviting()) {
                  <span class="flex items-center gap-2">
                    <z-icon zType="loader-circle" zSize="sm" class="animate-spin" />
                    {{ 'settings.team.inviteTeamMember.sending' | translate }}
                  </span>
                  } @else {
                  <span class="flex items-center gap-2">
                    <z-icon zType="mail" zSize="sm" />
                    {{ 'settings.team.inviteTeamMember.invite' | translate }}
                  </span>
                  }
                </z-button>
              </div>
            </div>
          </z-card>

          @if (isLoadingTeamMembers()) {
          <div class="flex items-center justify-center p-8">
            <div class="text-muted-foreground">{{ 'settings.team.loadingTeamMembers' | translate }}</div>
          </div>
          } @else if (teamMembers().length === 0) {
          <div class="flex items-center justify-center p-8">
            <div class="text-muted-foreground">{{ 'settings.team.noTeamMembersFound' | translate }}</div>
          </div>
          } @else {
          <div class="space-y-4">
            @for (member of teamMembers(); track member.id) {
            <z-card>
              <div class="space-y-4">
                <!-- User Card Header -->
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-4">
                    <z-avatar zSize="lg" zType="default"
                      [zImage]="member.avatar ? { url: member.avatar, fallback: (member.name || member.email).charAt(0).toUpperCase() } : { fallback: (member.name || member.email).charAt(0).toUpperCase() }" />
                    <div>
                      <div class="font-semibold">{{ member.name || ('settings.team.noName' | translate) }}</div>
                      <div class="text-sm text-muted-foreground">{{ member.email }}</div>
                      @if (member.phone) {
                      <div class="flex items-center gap-2 mt-1">
                        <z-icon zType="smartphone" zSize="sm" class="text-muted-foreground" />
                        <span class="text-xs text-muted-foreground">{{ member.phone }}</span>
                      </div>
                      }
                      @if (member.status === 'Pending') {
                      <z-badge zType="outline" class="mt-1 text-yellow-600 border-yellow-600 bg-yellow-50">{{ 'settings.team.pendingInvitation' | translate }}</z-badge>
                      }
                    </div>
                  </div>
                  <div class="flex items-center gap-3">
                    <div class="flex items-center gap-2">
                      <div class="relative flex-shrink-0">
                        <z-icon [zType]="getRoleIcon(member.role || '')" zSize="sm" class="text-muted-foreground" />
                        <div
                          class="absolute -top-1 -right-1 size-3 rounded-full bg-primary border-2 border-background flex items-center justify-center">
                          <svg class="size-1.5 text-primary-foreground" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                              clip-rule="evenodd" />
                          </svg>
                        </div>
                      </div>
                      <span class="text-sm font-medium">{{ member.role || ('settings.team.noRole' | translate) }}</span>
                    </div>
                    @if (!isCurrentUser(member)) {
                    <div class="flex items-center gap-2">
                      <z-button zType="outline" zSize="sm" (click)="togglePermissions(member)">
                        @if (editingUserId() === member.id) {
                        <z-icon zType="x" zSize="sm" />
                        {{ 'settings.team.close' | translate }}
                        } @else {
                        <z-icon zType="pencil" zSize="sm" />
                        {{ 'settings.team.modify' | translate }}
                        }
                      </z-button>
                      <z-button zType="outline" zSize="sm" (click)="deleteTeamMember(member)" class="text-destructive hover:text-destructive hover:bg-destructive/10 border-destructive/50">
                        <z-icon zType="x" zSize="sm" />
                        {{ 'common.delete' | translate }}
                      </z-button>
                    </div>
                    }
                  </div>
                </div>

                <!-- Permissions Section -->
                @if (editingUserId() === member.id) {
                <div class="border-t pt-4 space-y-4">
                  <!-- User Name and Email Display -->
                  <div class="space-y-1">
                    <div class="text-sm font-semibold">{{ 'settings.team.user' | translate }} {{ member.name || ('settings.team.noName' | translate) }}</div>
                    <div class="text-sm text-muted-foreground">{{ 'settings.team.email' | translate }} {{ member.email }}</div>
                  </div>

                  @if (isUserPermissionsLoading(member.id)) {
                  <div class="flex items-center justify-center p-8">
                    <div class="text-muted-foreground">{{ 'settings.team.loadingPermissions' | translate }}</div>
                  </div>
                  } @else if (getUserPermissions(member.id)) {
                  <div class="space-y-4">
                    <!-- Select All Permissions Header -->
                    <div
                      class="flex items-center gap-3 p-4 rounded-lg border bg-card cursor-pointer hover:bg-accent transition-colors"
                      (click)="toggleSelectAll(member.id)">
                      <div class="w-8 h-8 rounded bg-primary flex items-center justify-center flex-shrink-0">
                        <z-icon zType="check" zSize="sm" class="text-primary-foreground" />
                      </div>
                      <span class="font-medium">{{ 'settings.team.selectAllPermissions' | translate }}</span>
                    </div>

                    <!-- Permissions List -->
                    <div class="space-y-1">
                      <div class="text-sm font-semibold mb-3">{{ 'settings.team.permissions' | translate }}</div>
                      <div class="border rounded-lg divide-y">
                        @for (module of modules; track module.key) {
                        <div class="flex items-center gap-4 p-3 hover:bg-accent/50 transition-colors">
                          <!-- Module Name with Icon -->
                          <div class="flex items-center gap-2 min-w-[200px] flex-shrink-0">
                            <z-icon [zType]="$any(module.icon)" zSize="sm"
                              class="text-muted-foreground flex-shrink-0" />
                            <span class="text-sm font-medium">{{ module.label }}</span>
                          </div>

                          <!-- Permissions Checkboxes (Horizontal) -->
                          <div class="flex items-center gap-6 flex-1">
                            <div class="flex items-center gap-2">
                              <span class="text-xs text-muted-foreground min-w-[40px]">{{ 'settings.team.view' | translate }}</span>
                              <z-checkbox [ngModel]="getPermission(member.id, module.key, 'view')"
                                (ngModelChange)="updatePermission(member.id, module.key, 'view', $event)" />
                            </div>
                            <div class="flex items-center gap-2">
                              <span class="text-xs text-muted-foreground min-w-[40px]">{{ 'settings.team.edit' | translate }}</span>
                              <z-checkbox [ngModel]="getPermission(member.id, module.key, 'edit')"
                                (ngModelChange)="updatePermission(member.id, module.key, 'edit', $event)" />
                            </div>
                            <div class="flex items-center gap-2">
                              <span class="text-xs text-muted-foreground min-w-[50px]">{{ 'settings.team.delete' | translate }}</span>
                              <z-checkbox zType="destructive" [ngModel]="getPermission(member.id, module.key, 'delete')"
                                (ngModelChange)="updatePermission(member.id, module.key, 'delete', $event)" />
                            </div>
                            <div class="flex items-center gap-2 ml-auto">
                              <span class="text-xs font-medium min-w-[30px]">{{ 'settings.team.all' | translate }}</span>
                              <z-checkbox [ngModel]="getAllPermission(member.id, module.key)"
                                (ngModelChange)="updateAllPermission(member.id, module.key, $event)" />
                            </div>
                          </div>
                        </div>
                        }
                      </div>
                    </div>

                    <!-- Save Button -->
                    <div class="flex justify-end pt-2">
                      <z-button [zType]="isUserPermissionsSaving(member.id) ? 'ghost' : 'default'"
                        [disabled]="isUserPermissionsSaving(member.id)"
                        (click)="!isUserPermissionsSaving(member.id) && saveUserPermissions(member.id)">
                        @if (isUserPermissionsSaving(member.id)) {
                        <span class="flex items-center gap-2">
                          <z-icon zType="loader-circle" zSize="sm" class="animate-spin" />
                          {{ 'settings.team.saving' | translate }}
                        </span>
                        } @else {
                        {{ 'settings.team.savePermissions' | translate }}
                        }
                      </z-button>
                    </div>
                  </div>
                  }
                </div>
                }
              </div>
            </z-card>
            }
          </div>
          }
        </div>
        }

        @case ('application') {
        <div class="space-y-8">
          <h1 class="text-3xl font-bold">{{ 'settings.application.title' | translate }}</h1>

          <!-- Settings Accordion -->
          <div class="space-y-4">
            <!-- Layout Settings -->
            <div class="bg-card border border-border rounded-lg shadow-sm overflow-hidden">
              <z-accordion zType="single" class="border-0">
                <z-accordion-item [zTitle]="'settings.application.layoutSettings.title' | translate" zValue="layout-settings"
                  class="!px-6 !py-5 border-b-0 !text-lg">
                  <div class="mb-6">
                    <h3 class="text-sm font-medium mb-2">{{ 'settings.application.layoutSettings.preset' | translate }}</h3>
                    <p class="text-sm text-muted-foreground mb-4">{{ 'settings.application.layoutSettings.chooseColorTheme' | translate }}</p>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3">
                      @for (preset of themePresets; track preset.value) {
                      <button type="button" (click)="onThemeChange(preset.value)" [class]="currentTheme() === preset.value 
                                ? 'border-2 border-primary bg-primary/5 ring-2 ring-primary/20'
                                : 'border border-border hover:border-primary/50 hover:bg-accent/50'"
                        class="relative flex flex-col items-center gap-3 p-4 rounded-lg bg-card transition-all cursor-pointer group">
                        <!-- Color Swatch -->
                        <div class="size-12 rounded-lg flex-shrink-0 shadow-sm border border-border/50"
                          [style.background]="preset.color"></div>

                        <!-- Label -->
                        <span class="text-sm font-medium text-center">{{ preset.label }}</span>

                        <!-- Selected Indicator -->
                        @if (currentTheme() === preset.value) {
                        <div class="absolute top-2 right-2">
                          <div
                            class="size-5 rounded-full bg-primary text-primary-foreground flex items-center justify-center">
                            <z-icon zType="check" zSize="sm" />
                          </div>
                        </div>
                        }

                        <!-- Hover Effect -->
                        <div
                          class="absolute inset-0 rounded-lg bg-primary/0 group-hover:bg-primary/5 transition-colors pointer-events-none">
                        </div>
                      </button>
                      }
                    </div>
                  </div>
                </z-accordion-item>
              </z-accordion>
            </div>

            <!-- Property Settings -->
            <div class="bg-card border border-border rounded-lg shadow-sm overflow-hidden">
              <z-accordion zType="single" class="border-0">
                <z-accordion-item [zTitle]="'settings.application.property.title' | translate" zValue="property" class="!px-6 !py-5 border-b-0 !text-lg">
                  @if (isLoadingPropertySettings()) {
                  <div class="flex items-center justify-center p-8">
                    <div class="text-muted-foreground">{{ 'settings.application.property.loadingPropertySettings' | translate }}</div>
                  </div>
                  } @else {
                  <div class="space-y-8">
                    <!-- Default City -->
                    <div>
                      <h3 class="text-xl font-semibold mb-2">{{ 'settings.application.property.defaultCity.title' | translate }}</h3>
                      <p class="text-sm text-muted-foreground mb-4">{{ 'settings.application.property.defaultCity.description' | translate }}</p>
                      <z-form-field>
                        <z-form-label zRequired>{{ 'settings.application.property.defaultCity.label' | translate }}</z-form-label>
                        <z-form-control>
                          <z-select [zValue]="propertySettings.defaultCity()"
                            [zLabel]="propertySettings.defaultCity() || ('settings.application.property.defaultCity.selectCity' | translate)" [zPlaceholder]="'settings.application.property.defaultCity.selectCity' | translate"
                            (zSelectionChange)="propertySettings.defaultCity.set($event)" class="w-full">
                            <z-select-item zValue="Tanger">Tanger</z-select-item>
                            <z-select-item zValue="Casablanca">Casablanca</z-select-item>
                            <z-select-item zValue="Rabat">Rabat</z-select-item>
                            <z-select-item zValue="Kenitra">Kenitra</z-select-item>
                            <z-select-item zValue="Agadir">Agadir</z-select-item>
                          </z-select>
                        </z-form-control>
                      </z-form-field>
                    </div>

                    <!-- Default Categories -->
                    <div>
                      <h3 class="text-xl font-semibold mb-2">{{ 'settings.application.property.defaultCategories.title' | translate }}</h3>
                      <p class="text-sm text-muted-foreground mb-4">{{ 'settings.application.property.defaultCategories.description' | translate }}</p>
                      <div class="grid grid-cols-3 gap-3 mb-4">
                        @for (category of propertySettings.categories(); track category.key) {
                        <div class="p-3 border rounded-lg bg-card">
                          <z-form-field>
                            <z-form-label zRequired>{{ category.key }}</z-form-label>
                            <z-form-control>
                              <input z-input type="text" [value]="category.reference"
                                (blur)="updateCategoryReference(category.key, $event)" class="w-full" />
                            </z-form-control>
                          </z-form-field>
                        </div>
                        }
                      </div>
                    </div>

                    <!-- Property Types -->
                    <div>
                      <h3 class="text-xl font-semibold mb-2">{{ 'settings.application.property.propertyTypes.title' | translate }}</h3>
                      <p class="text-sm text-muted-foreground mb-4">{{ 'settings.application.property.propertyTypes.description' | translate }}</p>
                      <div class="flex flex-wrap gap-2 mb-4">
                        @for (type of propertySettings.propertyTypes(); track type) {
                        <z-badge zType="outline" class="flex items-center gap-1.5 px-3 py-1">
                          <span>{{ type }}</span>
                          <button type="button" (click)="removePropertyType(type)"
                            class="hover:text-destructive transition-colors" [attr.aria-label]="'settings.application.property.propertyTypes.removePropertyType' | translate">
                            <z-icon zType="x" zSize="sm" />
                          </button>
                        </z-badge>
                        }
                        @if (showAddPropertyTypeInput()) {
                        <div class="flex items-center gap-2">
                          <input z-input type="text" [ngModel]="newPropertyType()"
                            (ngModelChange)="newPropertyType.set($event)" (keyup.enter)="addPropertyType()"
                            (keyup.escape)="showAddPropertyTypeInput.set(false); newPropertyType.set('')"
                            [placeholder]="'settings.application.property.propertyTypes.enterPropertyType' | translate" class="w-48" autofocus />
                          <z-button zType="default" zSize="sm" (click)="addPropertyType()">
                            <z-icon zType="check" zSize="sm" />
                          </z-button>
                          <z-button zType="outline" zSize="sm"
                            (click)="showAddPropertyTypeInput.set(false); newPropertyType.set('')">
                            <z-icon zType="x" zSize="sm" />
                          </z-button>
                        </div>
                        } @else {
                        <z-button zType="outline" zSize="sm" (click)="showAddPropertyTypeInput.set(true)"
                          class="border-dashed border-primary/50 text-primary hover:bg-primary/5">
                          <z-icon zType="plus" zSize="sm" />
                          {{ 'settings.application.property.propertyTypes.addPropertyType' | translate }}
                        </z-button>
                        }
                      </div>
                    </div>

                    <!-- Property Characteristics (Features) -->
                    <div>
                      <h3 class="text-xl font-semibold mb-2">{{ 'settings.application.property.features.title' | translate }}</h3>
                      <p class="text-sm text-muted-foreground mb-4">{{ 'settings.application.property.features.description' | translate }}</p>
                      <div class="flex flex-wrap gap-2 mb-4">
                        @for (feature of propertySettings.features(); track feature) {
                        <z-badge zType="outline" class="flex items-center gap-1.5 px-3 py-1">
                          <span>{{ feature }}</span>
                          <button type="button" (click)="removeFeature(feature)"
                            class="hover:text-destructive transition-colors" [attr.aria-label]="'settings.application.property.features.removeFeature' | translate">
                            <z-icon zType="x" zSize="sm" />
                          </button>
                        </z-badge>
                        }
                        @if (showAddFeatureInput()) {
                        <div class="flex items-center gap-2">
                          <input z-input type="text" [ngModel]="newFeature()" (ngModelChange)="newFeature.set($event)"
                            (keyup.enter)="addFeature()"
                            (keyup.escape)="showAddFeatureInput.set(false); newFeature.set('')"
                            [placeholder]="'settings.application.property.features.enterFeature' | translate" class="w-48" autofocus />
                          <z-button zType="default" zSize="sm" (click)="addFeature()">
                            <z-icon zType="check" zSize="sm" />
                          </z-button>
                          <z-button zType="outline" zSize="sm"
                            (click)="showAddFeatureInput.set(false); newFeature.set('')">
                            <z-icon zType="x" zSize="sm" />
                          </z-button>
                        </div>
                        } @else {
                        <z-button zType="outline" zSize="sm" (click)="showAddFeatureInput.set(true)"
                          class="border-dashed border-primary/50 text-primary hover:bg-primary/5">
                          <z-icon zType="plus" zSize="sm" />
                          {{ 'settings.application.property.features.addFeature' | translate }}
                        </z-button>
                        }
                      </div>
                    </div>

                    <!-- Property Amenities -->
                    <div>
                      <h3 class="text-xl font-semibold mb-2">{{ 'settings.application.property.amenities.title' | translate }}</h3>
                      <p class="text-sm text-muted-foreground mb-4">{{ 'settings.application.property.amenities.description' | translate }}</p>
                      <div class="flex flex-wrap gap-2 mb-4">
                        @for (amenity of propertySettings.amenities(); track amenity) {
                        <z-badge zType="outline" class="flex items-center gap-1.5 px-3 py-1">
                          <span>{{ amenity }}</span>
                          <button type="button" (click)="removeAmenity(amenity)"
                            class="hover:text-destructive transition-colors" [attr.aria-label]="'settings.application.property.amenities.removeAmenity' | translate">
                            <z-icon zType="x" zSize="sm" />
                          </button>
                        </z-badge>
                        }
                        @if (showAddAmenityInput()) {
                        <div class="flex items-center gap-2">
                          <input z-input type="text" [ngModel]="newAmenity()" (ngModelChange)="newAmenity.set($event)"
                            (keyup.enter)="addAmenity()"
                            (keyup.escape)="showAddAmenityInput.set(false); newAmenity.set('')"
                            [placeholder]="'settings.application.property.amenities.enterAmenity' | translate" class="w-48" autofocus />
                          <z-button zType="default" zSize="sm" (click)="addAmenity()">
                            <z-icon zType="check" zSize="sm" />
                          </z-button>
                          <z-button zType="outline" zSize="sm"
                            (click)="showAddAmenityInput.set(false); newAmenity.set('')">
                            <z-icon zType="x" zSize="sm" />
                          </z-button>
                        </div>
                        } @else {
                        <z-button zType="outline" zSize="sm" (click)="showAddAmenityInput.set(true)"
                          class="border-dashed border-primary/50 text-primary hover:bg-primary/5">
                          <z-icon zType="plus" zSize="sm" />
                          {{ 'settings.application.property.amenities.addAmenity' | translate }}
                        </z-button>
                        }
                      </div>
                    </div>

                    <!-- Save Button -->
                    <div class="flex justify-end pt-4">
                      <z-button [zType]="isSavingPropertySettings() ? 'ghost' : 'default'"
                        [disabled]="isSavingPropertySettings()"
                        (click)="!isSavingPropertySettings() && onSavePropertySettings()">
                        @if (isSavingPropertySettings()) {
                        <span class="flex items-center gap-2">
                          <z-icon zType="loader-circle" zSize="sm" class="animate-spin" />
                          {{ 'settings.application.property.saving' | translate }}
                        </span>
                        } @else {
                        {{ 'settings.application.property.savePropertySettings' | translate }}
                        }
                      </z-button>
                    </div>
                  </div>
                  }
                </z-accordion-item>
              </z-accordion>
            </div>

            <!-- Signature Settings -->
            <div class="bg-card border border-border rounded-lg shadow-sm overflow-hidden">
              <z-accordion zType="single" class="border-0">
                <z-accordion-item [zTitle]="'settings.application.signature.title' | translate" zValue="signature" class="!px-6 !py-5 border-b-0 !text-lg">
                  <div class="space-y-6">
                    <div>
                      <h3 class="text-xl font-semibold mb-2">{{ 'settings.application.signature.title' | translate }}</h3>
                      <p class="text-sm text-muted-foreground mb-4">{{ 'settings.application.signature.description' | translate }}</p>
                      
                      <!-- Signature Image Display and Upload -->
                      <div class="flex gap-6">
                        <div class="flex-shrink-0">
                          <div class="relative">
                            @if (signatureImageUrl()) {
                              <div class="w-64 h-32 border border-border rounded-lg overflow-hidden bg-muted flex items-center justify-center">
                                <img 
                                  [src]="getSignatureImageUrl()" 
                                  alt="Signature"
                                  class="w-full h-full object-contain"
                                />
                              </div>
                            } @else {
                              <div class="w-64 h-32 border border-border rounded-lg flex items-center justify-center bg-muted">
                                <z-icon zType="file" zSize="lg" class="text-muted-foreground" />
                              </div>
                            }
                            <button type="button" (click)="onSignatureImageClick()"
                              class="absolute -bottom-1 -right-1 bg-primary text-primary-foreground rounded-full p-2 hover:bg-primary/90 transition-colors"
                              [title]="'settings.application.signature.uploadSignature' | translate">
                              <z-icon zType="camera" zSize="sm" />
                            </button>
                            <input #signatureFileInput type="file" accept="image/png,image/jpeg,image/jpg" (change)="onSignatureFileSelected($event)" class="hidden" />
                          </div>
                        </div>
                        
                        <div class="flex-1 space-y-4">
                          <div>
                            <p class="text-sm text-muted-foreground mb-2">{{ 'settings.application.signature.instructions' | translate }}</p>
                            <ul class="text-sm text-muted-foreground list-disc list-inside space-y-1">
                              <li>{{ 'settings.application.signature.maxFileSize' | translate }}</li>
                              <li>{{ 'settings.application.signature.supportedFormats' | translate }}</li>
                            </ul>
                          </div>
                          
                          @if (signatureImageUrl()) {
                            <div class="flex gap-3">
                              <z-button [zType]="isSavingSignature() ? 'ghost' : 'default'"
                                [disabled]="isSavingSignature()"
                                (click)="!isSavingSignature() && saveSignature()">
                                @if (isSavingSignature()) {
                                  <span class="flex items-center gap-2">
                                    <z-icon zType="loader-circle" zSize="sm" class="animate-spin" />
                                    {{ 'settings.application.signature.saving' | translate }}
                                  </span>
                                } @else {
                                  {{ 'settings.application.signature.saveSignature' | translate }}
                                }
                              </z-button>
                              <z-button zType="outline" zSize="default"
                                [disabled]="isSavingSignature()"
                                (click)="!isSavingSignature() && onDeleteSignature()"
                                class="text-destructive hover:text-destructive hover:bg-destructive/10 border-destructive/50">
                                <z-icon zType="x" zSize="sm" />
                                {{ 'settings.application.signature.deleteSignature' | translate }}
                              </z-button>
                            </div>
                          } @else {
                            <z-button [zType]="isSavingSignature() ? 'ghost' : 'default'"
                              [disabled]="isSavingSignature()"
                              (click)="!isSavingSignature() && onSignatureImageClick()">
                              @if (isSavingSignature()) {
                                <span class="flex items-center gap-2">
                                  <z-icon zType="loader-circle" zSize="sm" class="animate-spin" />
                                  {{ 'settings.application.signature.saving' | translate }}
                                </span>
                              } @else {
                                <z-icon zType="upload" zSize="sm" />
                                {{ 'settings.application.signature.uploadSignature' | translate }}
                              }
                            </z-button>
                          }
                        </div>
                      </div>
                    </div>
                  </div>
                </z-accordion-item>
              </z-accordion>
            </div>

            <!-- Notification Settings -->
            <div class="bg-card border border-border rounded-lg shadow-sm overflow-hidden">
              <z-accordion zType="single" class="border-0">
                <z-accordion-item [zTitle]="'settings.application.notification.title' | translate" zValue="notification" class="!px-6 !py-5 border-b-0 !text-lg">
                  @if (isLoadingNotificationSettings()) {
                  <div class="flex items-center justify-center p-8">
                    <div class="text-muted-foreground">{{ 'settings.application.notification.loadingNotificationSettings' | translate }}</div>
                  </div>
                  } @else {
                  <div class="space-y-8">
                    <!-- Email Section -->
                    <div>
                      <h3 class="text-xl font-semibold mb-4">{{ 'settings.application.notification.emailSection.title' | translate }}</h3>
                      
                      <!-- Lease Section -->
                      <div class="mb-6">
                        <h4 class="text-lg font-medium mb-3">{{ 'settings.application.notification.lease.title' | translate }}</h4>
                        
                        <!-- Lease Overdue -->
                        <div class="mb-4">
                          <z-form-field>
                            <z-form-label>{{ 'settings.application.notification.lease.overdue' | translate }}</z-form-label>
                            <z-form-control>
                              <textarea z-input [ngModel]="notificationSettings.lease.overdue()"
                                (ngModelChange)="notificationSettings.lease.overdue.set($event)"
                                rows="4" class="w-full resize-y"></textarea>
                            </z-form-control>
                          </z-form-field>
                        </div>

                        <!-- Lease Pending -->
                        <div class="mb-4">
                          <z-form-field>
                            <z-form-label>{{ 'settings.application.notification.lease.pending' | translate }}</z-form-label>
                            <z-form-control>
                              <textarea z-input [ngModel]="notificationSettings.lease.pending()"
                                (ngModelChange)="notificationSettings.lease.pending.set($event)"
                                rows="4" class="w-full resize-y"></textarea>
                            </z-form-control>
                          </z-form-field>
                        </div>

                        <!-- Lease Paid -->
                        <div class="mb-4">
                          <z-form-field>
                            <z-form-label>{{ 'settings.application.notification.lease.paid' | translate }}</z-form-label>
                            <z-form-control>
                              <textarea z-input [ngModel]="notificationSettings.lease.paid()"
                                (ngModelChange)="notificationSettings.lease.paid.set($event)"
                                rows="4" class="w-full resize-y"></textarea>
                            </z-form-control>
                          </z-form-field>
                        </div>
                      </div>

                      <!-- Maintenance Section -->
                      <div class="mb-6">
                        <h4 class="text-lg font-medium mb-3">{{ 'settings.application.notification.maintenance.title' | translate }}</h4>
                        
                        <!-- Maintenance Paid -->
                        <div class="mb-4">
                          <z-form-field>
                            <z-form-label>{{ 'settings.application.notification.maintenance.paid' | translate }}</z-form-label>
                            <z-form-control>
                              <textarea z-input [ngModel]="notificationSettings.maintenance.paid()"
                                (ngModelChange)="notificationSettings.maintenance.paid.set($event)"
                                rows="4" class="w-full resize-y"></textarea>
                            </z-form-control>
                          </z-form-field>
                        </div>
                      </div>

                      <!-- Reservation Section -->
                      <div class="mb-6">
                        <h4 class="text-lg font-medium mb-3">{{ 'settings.application.notification.reservation.title' | translate }}</h4>
                        
                        <!-- Reservation Confirmation -->
                        <div class="mb-4">
                          <z-form-field>
                            <z-form-label>{{ 'settings.application.notification.reservation.confirmation' | translate }}</z-form-label>
                            <z-form-control>
                              <textarea z-input [ngModel]="notificationSettings.reservation.confirmation()"
                                (ngModelChange)="notificationSettings.reservation.confirmation.set($event)"
                                rows="4" class="w-full resize-y"></textarea>
                            </z-form-control>
                          </z-form-field>
                        </div>

                        <!-- Reservation Enter -->
                        <div class="mb-4">
                          <z-form-field>
                            <z-form-label>{{ 'settings.application.notification.reservation.enter' | translate }}</z-form-label>
                            <z-form-control>
                              <textarea z-input [ngModel]="notificationSettings.reservation.enter()"
                                (ngModelChange)="notificationSettings.reservation.enter.set($event)"
                                rows="4" class="w-full resize-y"></textarea>
                            </z-form-control>
                          </z-form-field>
                        </div>

                        <!-- Reservation Left -->
                        <div class="mb-4">
                          <z-form-field>
                            <z-form-label>{{ 'settings.application.notification.reservation.left' | translate }}</z-form-label>
                            <z-form-control>
                              <textarea z-input [ngModel]="notificationSettings.reservation.left()"
                                (ngModelChange)="notificationSettings.reservation.left.set($event)"
                                rows="4" class="w-full resize-y"></textarea>
                            </z-form-control>
                          </z-form-field>
                        </div>
                      </div>

                      <!-- Save Button -->
                      <div class="flex justify-end pt-4">
                        <z-button [zType]="isSavingNotificationSettings() ? 'ghost' : 'default'"
                          [disabled]="isSavingNotificationSettings()"
                          (click)="!isSavingNotificationSettings() && onSaveNotificationSettings()">
                          @if (isSavingNotificationSettings()) {
                          <span class="flex items-center gap-2">
                            <z-icon zType="loader-circle" zSize="sm" class="animate-spin" />
                            {{ 'settings.application.notification.saving' | translate }}
                          </span>
                          } @else {
                          {{ 'settings.application.notification.saveNotificationSettings' | translate }}
                          }
                        </z-button>
                      </div>
                    </div>
                  </div>
                  }
                </z-accordion-item>
              </z-accordion>
            </div>
          </div>
        </div>
        }

        }
      </div>
    </div>
  </div>
</z-page>