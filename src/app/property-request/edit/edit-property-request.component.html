@if (isDialogMode()) {
  <div class="flex flex-col h-full min-h-0 overflow-hidden max-h-[85vh]">
    <!-- Header Section -->
    <div class="space-y-3 pb-4 flex-shrink-0">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-2xl font-bold mb-1">
            @if (isViewMode()) {
              {{ 'propertyRequest.edit.viewTitle' | translate }}
            } @else if (isEditMode()) {
              {{ 'propertyRequest.edit.editTitle' | translate }}
            } @else {
              {{ 'propertyRequest.edit.addTitle' | translate }}
            }
            @if (formData().budget || formData().pieces) {
              <span class="text-lg font-normal text-muted-foreground ml-2">
                @if (formData().budget) {
                  <span>{{ 'propertyRequest.edit.budget' | translate }}: {{ formData().budget | number }}</span>
                }
                @if (formData().budget && formData().pieces) {
                  <span class="mx-1">â€¢</span>
                }
                @if (formData().pieces) {
                  <span>{{ 'propertyRequest.edit.pieces' | translate }}: {{ formData().pieces }}</span>
                }
              </span>
            }
          </h2>
          <p class="text-sm text-muted-foreground">
            @if (isViewMode()) {
              {{ 'propertyRequest.edit.viewDescription' | translate }}
            } @else if (isEditMode()) {
              {{ 'propertyRequest.edit.editDescription' | translate }}
            } @else {
              {{ 'propertyRequest.edit.addDescription' | translate }}
            }
          </p>
        </div>
        <div class="flex gap-2">
          @if (!isViewMode()) {
            <z-button zType="outline" zSize="default" [disabled]="isSaving()" (click)="!isSaving() && onCancel()">
              {{ 'common.cancel' | translate }}
            </z-button>
            <z-button [zType]="isSaving() || !isFormValid() ? 'ghost' : 'default'" [disabled]="isSaving()" (click)="!isSaving() && onSave()">
              @if (isSaving()) {
                <span class="flex items-center gap-2">
                  <z-icon zType="loader-circle" zSize="sm" class="animate-spin" />
                  {{ 'propertyRequest.edit.saving' | translate }}
                </span>
              } @else {
                <z-icon zType="check" zSize="sm" class="mr-2" />
                @if (isEditMode()) {
                  {{ 'propertyRequest.edit.updatePropertyRequest' | translate }}
                } @else {
                  {{ 'propertyRequest.edit.createPropertyRequest' | translate }}
                }
              }
            </z-button>
          } @else {
            <z-button zType="outline" zSize="default" (click)="onCancel()">
              {{ 'common.close' | translate }}
            </z-button>
          }
        </div>
      </div>
    </div>

    <!-- Main Form Card -->
    <div class="flex-1 min-h-0 overflow-y-auto">
      @if (isLoading()) {
        <div class="flex items-center justify-center h-full">
          <div class="flex flex-col items-center gap-4">
            <z-icon zType="loader-circle" zSize="lg" class="animate-spin text-primary" />
            <p class="text-muted-foreground">{{ 'propertyRequest.edit.loading' | translate }}</p>
          </div>
        </div>
      } @else {
        <div class="space-y-6">
          <!-- Form Section --><z-card><div class="p-6 space-y-6"><div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Category -->
                <z-form-field>
                  <z-form-label [zRequired]="!isViewMode()">{{ 'propertyRequest.edit.category' | translate }}</z-form-label>
                  <z-form-control [errorMessage]="categoryError()">
                    <z-select
                      [zValue]="formData().category?.toString() ?? ''"
                      [zLabel]="getCategoryLabel()"
                      [zPlaceholder]="'propertyRequest.edit.categoryPlaceholder' | translate"
                      (zSelectionChange)="updateCategory(+$event)"
                      [zDisabled]="isViewMode()"
                    >
                      <z-select-item [zValue]="PropertyCategory.Location.toString()">{{ 'property.categories.location' | translate }}</z-select-item>
                      <z-select-item [zValue]="PropertyCategory.Vente.toString()">{{ 'property.categories.vente' | translate }}</z-select-item>
                      <z-select-item [zValue]="PropertyCategory.LocationVacances.toString()">{{ 'property.categories.locationVacances' | translate }}</z-select-item>
                    </z-select>
                  </z-form-control>
                </z-form-field>
              
                <!-- Budget -->
                <z-form-field>
                  <z-form-label [zRequired]="!isViewMode()">{{ 'propertyRequest.edit.budget' | translate }}</z-form-label>
                  <z-form-control [errorMessage]="budgetError()">
                    <z-input-group>
                      <input
                        z-input
                        type="number"
                        [ngModel]="formData().budget"
                        (ngModelChange)="updateBudget($event)"
                        [placeholder]="'propertyRequest.edit.budgetPlaceholder' | translate"
                        [disabled]="isViewMode()"
                      />
                    </z-input-group>
                  </z-form-control>
                </z-form-field>

                <!-- Pieces -->
                <z-form-field>
                  <z-form-label [zRequired]="!isViewMode()">{{ 'propertyRequest.edit.pieces' | translate }}</z-form-label>
                  <z-form-control [errorMessage]="piecesError()">
                    <z-input-group>
                      <input
                        z-input
                        type="number"
                        [ngModel]="formData().pieces"
                        (ngModelChange)="updatePieces($event)"
                        [placeholder]="'propertyRequest.edit.piecesPlaceholder' | translate"
                        [disabled]="isViewMode()"
                      />
                    </z-input-group>
                  </z-form-control>
                </z-form-field>

                <!-- Bathrooms -->
                <z-form-field>
                  <z-form-label>{{ 'propertyRequest.edit.bathrooms' | translate }}</z-form-label>
                  <z-form-control>
                    <z-input-group>
                      <input
                        z-input
                        type="number"
                        [ngModel]="formData().bathrooms"
                        (ngModelChange)="updateBathrooms($event)"
                        [placeholder]="'propertyRequest.edit.bathroomsPlaceholder' | translate"
                        [disabled]="isViewMode()"
                      />
                    </z-input-group>
                  </z-form-control>
                </z-form-field>

                <!-- Is Furnished -->
                <z-form-field>
                  <z-form-label>{{ 'propertyRequest.edit.isFurnished' | translate }}</z-form-label>
                  <z-form-control>
                    <div class="flex items-center space-x-2">
                      <z-checkbox
                        [ngModel]="formData().isFurnished"
                        (checkChange)="updateIsFurnished($event)"
                        [disabled]="isViewMode()"
                      />
                      <span class="text-sm text-muted-foreground">{{ 'propertyRequest.edit.isFurnished' | translate }}</span>
                    </div>
                  </z-form-control>
                </z-form-field>

                <!-- Price -->
                <z-form-field>
                  <z-form-label>{{ 'propertyRequest.edit.price' | translate }}</z-form-label>
                  <z-form-control>
                    <z-input-group>
                      <input
                        z-input
                        type="number"
                        [ngModel]="formData().price"
                        (ngModelChange)="updatePrice($event)"
                        [placeholder]="'propertyRequest.edit.pricePlaceholder' | translate"
                        [disabled]="isViewMode()"
                      />
                    </z-input-group>
                  </z-form-control>
                </z-form-field>

                <!-- Surface -->
                <z-form-field>
                  <z-form-label>{{ 'propertyRequest.edit.surface' | translate }}</z-form-label>
                  <z-form-control>
                    <z-input-group>
                      <input
                        z-input
                        type="number"
                        [ngModel]="formData().surface"
                        (ngModelChange)="updateSurface($event)"
                        [placeholder]="'propertyRequest.edit.surfacePlaceholder' | translate"
                        [disabled]="isViewMode()"
                      />
                    </z-input-group>
                  </z-form-control>
                </z-form-field>

                <!-- Zone -->
                <z-form-field>
                  <z-form-label>{{ 'propertyRequest.edit.zone' | translate }}</z-form-label>
                  <z-form-control>
                    <z-input-group>
                      <input
                        z-input
                        type="text"
                        [ngModel]="formData().zone"
                        (ngModelChange)="updateZone($event)"
                        [placeholder]="'propertyRequest.edit.zonePlaceholder' | translate"
                        [disabled]="isViewMode()"
                      />
                    </z-input-group>
                  </z-form-control>
                </z-form-field>

                <!-- Ville -->
                <z-form-field>
                  <z-form-label>{{ 'propertyRequest.edit.ville' | translate }}</z-form-label>
                  <z-form-control>
                    <z-input-group>
                      <input
                        z-input
                        type="text"
                        [ngModel]="formData().ville"
                        (ngModelChange)="updateVille($event)"
                        [placeholder]="'propertyRequest.edit.villePlaceholder' | translate"
                        [disabled]="isViewMode()"
                      />
                    </z-input-group>
                  </z-form-control>
                </z-form-field>
              </div>

              <!-- Description -->
              <z-form-field>
                <z-form-label>{{ 'propertyRequest.edit.description' | translate }}</z-form-label>
                <z-form-control>
                  <textarea
                    z-input
                    [ngModel]="formData().description"
                    (ngModelChange)="updateDescription($event)"
                    [placeholder]="'propertyRequest.edit.descriptionPlaceholder' | translate"
                    rows="4"
                    [disabled]="isViewMode()"
                  ></textarea>
                </z-form-control>
              </z-form-field>
            </div>
          </z-card>
        </div>
      }
    </div>
  </div>
} @else {
  <!-- Page Mode (if needed in future) -->
  <z-page [zTitle]="isEditMode() ? ('propertyRequest.edit.editTitle' | translate) : ('propertyRequest.edit.addTitle' | translate)">
    <div class="flex flex-col min-h-0 h-full overflow-hidden">
      <!-- Similar content as dialog mode -->
    </div>
  </z-page>
}

