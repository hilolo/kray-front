<div class="absolute inset-0 flex flex-col min-w-0 overflow-hidden">

    <div class="flex flex-col h-full bg-card dark:bg-transparent">

        <!-- Main -->
        <div class="flex flex-col flex-auto overflow-hidden">

            <!-- Header -->
            <div class="flex flex-col py-6 px-6 md:px-8 border-b flex-shrink-0">

                <!-- Title Row -->
                <div class="mb-6">
                    <div class="text-4xl font-extrabold tracking-tight leading-none">Vacation Rental Reservations</div>
                    <div class="ml-0.5 font-medium text-secondary">
                        <ng-container *ngIf="totalItems === 0">0 Total</ng-container>
                        <ng-container *ngIf="totalItems === 1">1 Total</ng-container>
                        <ng-container *ngIf="totalItems > 1">{{ totalItems }} Total</ng-container>
                    </div>
                </div>

                <!-- Search, View Toggle, and Add Button Row -->
                <div class="flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-4">
                    <!-- Left Side: Search with Clear Filters Button -->
                    <div class="flex items-center gap-2 flex-1 max-w-md">
                        <mat-form-field class="fuse-mat-dense fuse-mat-rounded flex-1" subscriptSizing="dynamic">
                            <mat-icon class="icon-size-5" matPrefix [svgIcon]="'heroicons_solid:magnifying-glass'"></mat-icon>
                            <input matInput [formControl]="searchInputControl.get('searchQuery')" [autocomplete]="'off'" [placeholder]="'Search reservations...'" />
                        </mat-form-field>
                        
                        <!-- Clear Filters Button -->
                        <button mat-stroked-button color="warn" *ngIf="hasActiveFilters() || searchInputControl.get('searchQuery').value"
                            (click)="clearAllFilters(); searchInputControl.patchValue({searchQuery: ''})"
                            class="min-w-0 hidden sm:flex">
                            <mat-icon class="icon-size-5 mr-2" [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                            <span>Clear Filters</span>
                        </button>
                    </div>

                    <!-- Right Side: Today's Date, View Toggle and Add Button -->
                    <div class="flex items-center gap-4">
                        <!-- Today's Date Display -->
                        <div class="hidden md:flex items-center gap-3 px-4 py-2.5 rounded-lg bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border border-blue-200 dark:border-blue-800">
                            <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 shadow-md">
                                <mat-icon class="icon-size-5 text-white" [svgIcon]="'heroicons_outline:calendar-days'"></mat-icon>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-xs font-medium text-secondary uppercase tracking-wider">Today</span>
                                <div class="flex items-baseline gap-1.5">
                                    <span class="text-lg font-bold text-gray-900 dark:text-white">{{ currentDate | date:'dd' }}</span>
                                    <span class="text-sm font-semibold text-primary">{{ currentDate | date:'MMM' }}</span>
                                    <span class="text-sm font-medium text-secondary">{{ currentDate | date:'yyyy' }}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- View toggle buttons -->
                        <mat-button-toggle-group [value]="viewMode" (change)="switchView($event.value)">
                            <mat-button-toggle value="list">
                                <mat-icon [svgIcon]="'heroicons_outline:list-bullet'"></mat-icon>
                                <span class="ml-2 hidden sm:inline">List</span>
                            </mat-button-toggle>
                            <mat-button-toggle value="calendar">
                                <mat-icon [svgIcon]="'heroicons_outline:calendar'"></mat-icon>
                                <span class="ml-2 hidden sm:inline">Calendar</span>
                            </mat-button-toggle>
                        </mat-button-toggle-group>

                        <!-- Add reservation button -->
                        <button mat-flat-button [color]="'primary'" (click)="createReservation()">
                            <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                            <span class="ml-2 mr-1">Add</span>
                        </button>
                    </div>
                </div>

            </div>

            <!-- List View -->
            <div *ngIf="viewMode === 'list'" class="flex flex-col flex-auto overflow-hidden">
                
                <!-- Filters Section for List View -->
                <div class="bg-white dark:bg-gray-800 border-b px-6 py-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Property Filter -->
                        <div class="relative">
                            <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-full" subscriptSizing="dynamic">
                                <mat-label>Property</mat-label>
                                <input matInput 
                                       type="text"
                                       [value]="isEditingProperty ? propertySearchTerm : getSelectedPropertyName()"
                                       (input)="onPropertyInput($event)"
                                       (focus)="onPropertyFocus()"
                                       (blur)="onPropertyBlur()"
                                       placeholder="Search properties..."
                                       autocomplete="off">
                                <mat-icon matPrefix class="icon-size-5" [svgIcon]="'heroicons_solid:building-office-2'"></mat-icon>
                                <button mat-icon-button matSuffix *ngIf="selectedPropertyId"
                                        (click)="clearPropertyFilter(); $event.stopPropagation()"
                                        class="icon-size-5">
                                    <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                                </button>
                            </mat-form-field>
                            
                            <!-- Property Dropdown -->
                            <div *ngIf="showPropertyDropdown && filteredProperties.length > 0" 
                                 class="absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                                <div class="px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-700"
                                     (mousedown)="selectProperty(null)">
                                    <div class="font-medium text-gray-900 dark:text-white">All Properties</div>
                                </div>
                                <div *ngFor="let property of filteredProperties" 
                                     class="px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-700 last:border-b-0"
                                     (mousedown)="selectProperty(property.id)">
                                    <div class="font-medium text-gray-900 dark:text-white">{{ property.name }}</div>
                                    <div class="text-sm text-secondary">{{ property.address }}</div>
                                </div>
                            </div>
                        </div>

                        <!-- Tenant Filter -->
                        <div class="relative">
                            <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-full" subscriptSizing="dynamic">
                                <mat-label>Tenant</mat-label>
                                <input matInput 
                                       type="text"
                                       [value]="isEditingTenant ? tenantSearchTerm : getSelectedTenantName()"
                                       (input)="onTenantInput($event)"
                                       (focus)="onTenantFocus()"
                                       (blur)="onTenantBlur()"
                                       placeholder="Search tenants..."
                                       autocomplete="off">
                                <mat-icon matPrefix class="icon-size-5" [svgIcon]="'heroicons_solid:user'"></mat-icon>
                                <button mat-icon-button matSuffix *ngIf="selectedTenantId"
                                        (click)="clearTenantFilter(); $event.stopPropagation()"
                                        class="icon-size-5">
                                    <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                                </button>
                            </mat-form-field>
                            
                            <!-- Tenant Dropdown -->
                            <div *ngIf="showTenantDropdown && filteredTenants.length > 0" 
                                 class="absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                                <div class="px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-700"
                                     (mousedown)="selectTenant(null)">
                                    <div class="font-medium text-gray-900 dark:text-white">All Tenants</div>
                                </div>
                                <div *ngFor="let tenant of filteredTenants" 
                                     class="px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-700 last:border-b-0"
                                     (mousedown)="selectTenant(tenant.id)">
                                    <div class="font-medium text-gray-900 dark:text-white">{{ tenant.name }}</div>
                                    <div class="text-sm text-secondary flex items-center gap-2">
                                        <span *ngIf="tenant.identifier" class="text-blue-600 dark:text-blue-400">{{ tenant.identifier }}</span>
                                        <span *ngIf="tenant.identifier && tenant.email" class="text-gray-400">•</span>
                                        <span>{{ tenant.email }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Date Filter -->
                        <div class="relative">
                            <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-full" subscriptSizing="dynamic">
                                <mat-label>Date Range</mat-label>
                                <input matInput 
                                       type="text"
                                       [value]="getSelectedDateFilterLabel()"
                                       (focus)="showDateDropdown = true"
                                       (blur)="showDateDropdown = false"
                                       placeholder="This Month"
                                       readonly
                                       autocomplete="off">
                                <mat-icon matPrefix class="icon-size-5" [svgIcon]="'heroicons_solid:calendar'"></mat-icon>
                                <button mat-icon-button matSuffix *ngIf="selectedDateFilter !== 'thisMonth'"
                                        (click)="selectDateFilter('thisMonth'); $event.stopPropagation()"
                                        class="icon-size-5">
                                    <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                                </button>
                            </mat-form-field>
                            
                            <!-- Date Filter Dropdown -->
                            <div *ngIf="showDateDropdown" 
                                 class="absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-80 overflow-y-auto">
                                <div *ngFor="let option of dateFilterOptions" 
                                     class="px-3 py-2 cursor-pointer border-b border-gray-200 dark:border-gray-700 last:border-b-0"
                                     [ngClass]="{
                                         'bg-green-100 dark:bg-green-900/30 hover:bg-green-200 dark:hover:bg-green-900/50': selectedDateFilter === option.value,
                                         'hover:bg-gray-100 dark:hover:bg-gray-700': selectedDateFilter !== option.value
                                     }"
                                     (mousedown)="selectDateFilter(option.value)">
                                    <div class="font-medium text-gray-900 dark:text-white">{{ option.label }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- List Content -->
                <div class="relative flex-auto overflow-y-auto">
                <ng-container *ngIf="!isLoading && getFilteredReservations().length > 0">
                    <ng-container *ngFor="let reservation of getFilteredReservations(); trackBy: trackByFn">
                        <!-- Reservation Row -->
                        <div class="flex flex-col sm:flex-row items-stretch gap-4 p-6 border-b hover:bg-gray-50 dark:hover:bg-hover cursor-pointer transition-all"
                             (click)="editReservation(reservation)">
                            
                            <!-- Property Image -->
                            <div class="flex-shrink-0">
                                <div class="w-full sm:w-40 h-32 rounded-xl overflow-hidden bg-gray-200 dark:bg-gray-700 shadow-sm">
                                    <img *ngIf="reservation.propertyImageUrl" 
                                         [src]="reservation.propertyImageUrl" 
                                         [alt]="reservation.propertyName"
                                         class="w-full h-full object-cover"
                                         (error)="$event.target.src='assets/images/placeholder-property.png'">
                                    <div *ngIf="!reservation.propertyImageUrl" 
                                         class="w-full h-full flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600">
                                        <mat-icon class="icon-size-12 text-white" [svgIcon]="'heroicons_outline:home'"></mat-icon>
                                    </div>
                                </div>
                            </div>

                            <!-- Content -->
                            <div class="flex flex-col flex-auto min-w-0">
                                <div class="flex flex-col sm:flex-row sm:items-start justify-between gap-4 mb-4">
                                    <div class="flex-auto min-w-0">
                                        <!-- Property Name -->
                                        <div class="flex items-center gap-2 mb-2">
                                            <span class="inline-flex items-center px-2 py-1 rounded text-xs font-semibold bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400">
                                                {{ reservation.propertyIdentifier || 'N/A' }}
                                            </span>
                                            <div class="text-lg font-semibold text-gray-900 dark:text-white truncate">
                                                {{ reservation.propertyName || 'N/A' }}
                                            </div>
                                        </div>

                                        <!-- Property Address -->
                                        <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2">
                                            <mat-icon class="icon-size-4" [svgIcon]="'heroicons_outline:map-pin'"></mat-icon>
                                            <span class="truncate">{{ reservation.propertyAddress || 'No address' }}</span>
                                        </div>

                                        <!-- Tenant Info -->
                                        <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2">
                                            <mat-icon class="icon-size-4" [svgIcon]="'heroicons_outline:user'"></mat-icon>
                                            <span>{{ reservation.contactName || 'N/A' }}</span>
                                        </div>

                                        <!-- Dates -->
                                        <div class="flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400">
                                            <div class="flex items-center gap-1">
                                                <mat-icon class="icon-size-4 text-green-600" [svgIcon]="'heroicons_outline:arrow-right-circle'"></mat-icon>
                                                <span>{{ reservation.startDate | date:'dd/MM/yyyy' }}</span>
                                            </div>
                                            <span class="text-gray-400">→</span>
                                            <div class="flex items-center gap-1">
                                                <mat-icon class="icon-size-4 text-red-600" [svgIcon]="'heroicons_outline:arrow-left-circle'"></mat-icon>
                                                <span>{{ reservation.endDate | date:'dd/MM/yyyy' }}</span>
                                            </div>
                                            <span class="text-gray-400">•</span>
                                            <span>{{ reservation.numberOfNights || reservation.durationDays }} nights</span>
                                        </div>
                                    </div>

                                    <!-- Status Section -->
                                    <div class="flex-shrink-0 sm:w-40">
                                        <div class="p-4 rounded-xl border-2 shadow-sm h-full flex flex-col items-center justify-center"
                                             [ngClass]="{
                                                 'bg-yellow-50 dark:bg-yellow-900/20 border-yellow-300 dark:border-yellow-700': getReservationStatusBadgeClass(reservation.status) === 'bg-yellow-500',
                                                 'bg-green-50 dark:bg-green-900/20 border-green-300 dark:border-green-700': getReservationStatusBadgeClass(reservation.status) === 'bg-green-500',
                                                 'bg-gray-50 dark:bg-gray-900/20 border-gray-300 dark:border-gray-700': getReservationStatusBadgeClass(reservation.status) === 'bg-gray-500'
                                             }">
                                            <div class="text-xs font-semibold uppercase tracking-wider text-gray-600 dark:text-gray-400 mb-2">Status</div>
                                            <div class="flex flex-col items-center gap-2">
                                                <mat-icon *ngIf="getReservationStatusIcon(reservation.status)" 
                                                          class="icon-size-8"
                                                          [ngClass]="{
                                                              'text-yellow-600 dark:text-yellow-400': getReservationStatusBadgeClass(reservation.status) === 'bg-yellow-500',
                                                              'text-green-600 dark:text-green-400': getReservationStatusBadgeClass(reservation.status) === 'bg-green-500',
                                                              'text-gray-600 dark:text-gray-400': getReservationStatusBadgeClass(reservation.status) === 'bg-gray-500'
                                                          }"
                                                          [svgIcon]="getReservationStatusIcon(reservation.status)"></mat-icon>
                                                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-bold text-white"
                                                      [ngClass]="getReservationStatusBadgeClass(reservation.status)">
                                                    <mat-icon *ngIf="getReservationStatusIcon(reservation.status)" 
                                                              class="icon-size-4" 
                                                              [svgIcon]="getReservationStatusIcon(reservation.status)"></mat-icon>
                                                    {{ getReservationStatusLabel(reservation.status) }}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Bottom Row: Amount and Actions -->
                                <div class="flex items-center justify-between gap-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center gap-2">
                                        <span class="text-lg font-bold text-gray-900 dark:text-white">
                                            {{ reservation.totalAmount | number:'1.2-2' }} MAD
                                        </span>
                                    </div>

                                    <div class="flex items-center gap-2">
                                        <button mat-icon-button [matMenuTriggerFor]="statusMenuList" [matTooltip]="'Change Status'" (click)="$event.stopPropagation()">
                                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:arrow-path'"></mat-icon>
                                        </button>
                                        <mat-menu #statusMenuList="matMenu">
                                            <button mat-menu-item (click)="updateStatus(reservation, 0)">
                                                <mat-icon class="text-yellow-500" [svgIcon]="'heroicons_outline:clock'"></mat-icon>
                                                <span>Pending</span>
                                            </button>
                                            <button mat-menu-item (click)="updateStatus(reservation, 1)">
                                                <mat-icon class="text-green-500" [svgIcon]="'heroicons_outline:check-circle'"></mat-icon>
                                                <span>Approved</span>
                                            </button>
                                            <button mat-menu-item (click)="updateStatus(reservation, 3)">
                                                <mat-icon class="text-gray-500" [svgIcon]="'heroicons_outline:ban'"></mat-icon>
                                                <span>Cancelled</span>
                                            </button>
                                        </mat-menu>
                                        <button mat-icon-button [matTooltip]="'View Details'" color="primary" (click)="editReservation(reservation); $event.stopPropagation()">
                                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:eye'"></mat-icon>
                                        </button>
                                        <button mat-icon-button [matTooltip]="'Delete'" color="warn" (click)="deleteReservation(reservation, $event)">
                                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>

                <!-- No results -->
                <div *ngIf="!isLoading && getFilteredReservations().length === 0 && reservations.length === 0" class="flex items-center justify-center h-full">
                    <app-no-data message="No reservations found! Start by creating a new vacation rental reservation"></app-no-data>
                </div>
                
                <!-- No results after filtering -->
                <div *ngIf="!isLoading && getFilteredReservations().length === 0 && reservations.length > 0" class="flex items-center justify-center h-full">
                    <div class="text-center p-8">
                        <mat-icon class="icon-size-24 text-gray-300" [svgIcon]="'heroicons_outline:funnel'"></mat-icon>
                        <div class="mt-4 text-2xl font-semibold tracking-tight text-secondary">No matching reservations</div>
                        <div class="mt-2 text-md text-secondary">Try adjusting your filters</div>
                    </div>
                </div>

                <!-- Loading -->
                <div *ngIf="isLoading" class="flex items-center justify-center h-full p-8 sm:p-16">
                    <div class="flex flex-col items-center">
                        <mat-icon class="icon-size-16 animate-spin" [svgIcon]="'heroicons_outline:arrow-path'"></mat-icon>
                        <div class="mt-4 text-secondary">Loading reservations...</div>
                    </div>
                </div>
                </div>
            </div>

            <!-- Calendar View -->
            <div *ngIf="viewMode === 'calendar'" class="flex flex-col flex-auto overflow-y-auto md:overflow-hidden">
                
                <!-- Filters Section for Calendar View -->
                <div class="bg-white dark:bg-gray-800 border-b px-6 py-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Property Filter -->
                            <div class="relative">
                                <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-full" subscriptSizing="dynamic">
                                    <mat-label>Property</mat-label>
                                    <input matInput 
                                           type="text"
                                           [value]="isEditingProperty ? propertySearchTerm : getSelectedPropertyName()"
                                           (input)="onPropertyInput($event)"
                                           (focus)="onPropertyFocus()"
                                           (blur)="onPropertyBlur()"
                                           placeholder="Search properties..."
                                           autocomplete="off">
                                    <mat-icon matPrefix class="icon-size-5" [svgIcon]="'heroicons_solid:building-office-2'"></mat-icon>
                                    <button mat-icon-button matSuffix *ngIf="selectedPropertyId"
                                            (click)="clearPropertyFilter(); $event.stopPropagation()"
                                            class="icon-size-5">
                                        <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                                    </button>
                                </mat-form-field>
                                
                                <!-- Property Dropdown -->
                                <div *ngIf="showPropertyDropdown && filteredProperties.length > 0" 
                                     class="absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                                    <div class="px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-700"
                                         (mousedown)="selectProperty(null)">
                                        <div class="font-medium text-gray-900 dark:text-white">All Properties</div>
                                    </div>
                                    <div *ngFor="let property of filteredProperties" 
                                         class="px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-700 last:border-b-0"
                                         (mousedown)="selectProperty(property.id)">
                                        <div class="font-medium text-gray-900 dark:text-white">{{ property.name }}</div>
                                        <div class="text-sm text-secondary">{{ property.address }}</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tenant Filter -->
                            <div class="relative">
                                <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-full" subscriptSizing="dynamic">
                                    <mat-label>Tenant</mat-label>
                                    <input matInput 
                                           type="text"
                                           [value]="isEditingTenant ? tenantSearchTerm : getSelectedTenantName()"
                                           (input)="onTenantInput($event)"
                                           (focus)="onTenantFocus()"
                                           (blur)="onTenantBlur()"
                                           placeholder="Search tenants..."
                                           autocomplete="off">
                                    <mat-icon matPrefix class="icon-size-5" [svgIcon]="'heroicons_solid:user'"></mat-icon>
                                    <button mat-icon-button matSuffix *ngIf="selectedTenantId"
                                            (click)="clearTenantFilter(); $event.stopPropagation()"
                                            class="icon-size-5">
                                        <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                                    </button>
                                </mat-form-field>
                                
                                <!-- Tenant Dropdown -->
                                <div *ngIf="showTenantDropdown && filteredTenants.length > 0" 
                                     class="absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                                    <div class="px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-700"
                                         (mousedown)="selectTenant(null)">
                                        <div class="font-medium text-gray-900 dark:text-white">All Tenants</div>
                                    </div>
                                    <div *ngFor="let tenant of filteredTenants" 
                                         class="px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-700 last:border-b-0"
                                         (mousedown)="selectTenant(tenant.id)">
                                        <div class="font-medium text-gray-900 dark:text-white">{{ tenant.name }}</div>
                                        <div class="text-sm text-secondary flex items-center gap-2">
                                            <span *ngIf="tenant.identifier" class="text-blue-600 dark:text-blue-400">{{ tenant.identifier }}</span>
                                            <span *ngIf="tenant.identifier && tenant.email" class="text-gray-400">•</span>
                                            <span>{{ tenant.email }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                <!-- Calendar Content with Sidebar -->
                <div class="flex flex-col lg:flex-row flex-auto md:overflow-hidden">
                    
                    <!-- Mobile: Month Navigation (Visible only on mobile) -->
                    <div class="md:hidden bg-white dark:bg-gray-800 border-b px-4 py-3 flex items-center justify-between flex-shrink-0">
                        <div class="flex items-center">
                            <button mat-icon-button (click)="previousMonth()">
                                <mat-icon [svgIcon]="'heroicons_outline:chevron-left'"></mat-icon>
                            </button>
                            <h2 class="text-lg font-bold mx-2">{{ getMonthName() }} {{ currentYear }}</h2>
                            <button mat-icon-button (click)="nextMonth()">
                                <mat-icon [svgIcon]="'heroicons_outline:chevron-right'"></mat-icon>
                            </button>
                        </div>
                        <button mat-stroked-button (click)="goToToday()" class="text-xs">
                            Today
                        </button>
                    </div>
                    
                    <!-- Left Side: Calendar Grid (Hidden on mobile, shown on md and up) -->
                    <div class="hidden md:flex flex-1 flex-col overflow-y-auto overflow-x-hidden p-4 sm:p-6">
                    <!-- Calendar Header -->
                    <div class="flex items-center justify-between mb-4 flex-shrink-0">
                        <div class="flex items-center">
                            <button mat-icon-button (click)="previousMonth()">
                                <mat-icon [svgIcon]="'heroicons_outline:chevron-left'"></mat-icon>
                            </button>
                            <h2 class="text-xl font-bold mx-3">{{ getMonthName() }} {{ currentYear }}</h2>
                            <button mat-icon-button (click)="nextMonth()">
                                <mat-icon [svgIcon]="'heroicons_outline:chevron-right'"></mat-icon>
                            </button>
                        </div>
                        <button mat-stroked-button (click)="goToToday()" class="text-sm">
                            Today
                        </button>
                    </div>

                        <!-- Calendar Grid Wrapper -->
                    <div class="flex-auto overflow-x-auto overflow-y-auto touch-pan-x touch-pan-y" style="min-width: 0; -webkit-overflow-scrolling: touch;">
                        <div class="bg-card rounded-lg shadow overflow-hidden" style="min-width: 640px;">
                            <!-- Week Days Header -->
                            <div class="grid grid-cols-7 gap-px bg-gray-200 dark:bg-gray-700">
                                <div class="bg-gray-50 dark:bg-gray-800 p-2 text-center font-semibold text-xs">Sun</div>
                                <div class="bg-gray-50 dark:bg-gray-800 p-2 text-center font-semibold text-xs">Mon</div>
                                <div class="bg-gray-50 dark:bg-gray-800 p-2 text-center font-semibold text-xs">Tue</div>
                                <div class="bg-gray-50 dark:bg-gray-800 p-2 text-center font-semibold text-xs">Wed</div>
                                <div class="bg-gray-50 dark:bg-gray-800 p-2 text-center font-semibold text-xs">Thu</div>
                                <div class="bg-gray-50 dark:bg-gray-800 p-2 text-center font-semibold text-xs">Fri</div>
                                <div class="bg-gray-50 dark:bg-gray-800 p-2 text-center font-semibold text-xs">Sat</div>
                            </div>

                            <!-- Calendar Days -->
                            <div class="grid grid-cols-7 gap-px bg-gray-200 dark:bg-gray-700">
                                <div *ngFor="let day of calendarDays; trackBy: trackByFn"
                                         class="bg-white dark:bg-gray-900 min-h-24 p-2 relative overflow-hidden transition-opacity duration-200"
                                     [ngClass]="{
                                         'bg-gray-50 dark:bg-gray-800 opacity-40': !day.isCurrentMonth,
                                         'ring-2 ring-primary': day.isToday,
                                         'opacity-100': day.isCurrentMonth
                                     }">
                                    
                                    <!-- Large Background Day Number (only for current month) -->
                                    <div *ngIf="day.isCurrentMonth" class="absolute inset-0 flex items-center justify-center pointer-events-none select-none">
                                        <span class="text-7xl font-black leading-none"
                                              [ngClass]="{
                                                  'text-gray-300/40 dark:text-gray-600/40': !day.isToday,
                                                  'text-primary/20 dark:text-primary/15': day.isToday
                                              }">
                                            {{ day.date.getDate() }}
                                        </span>
                                    </div>
                                    
                                    <!-- Small Corner Day Number -->
                                    <div class="relative z-10 flex justify-between items-start mb-1">
                                        <span class="text-sm font-medium"
                                              [ngClass]="{
                                                  'text-gray-400': !day.isCurrentMonth,
                                                  'text-primary font-bold': day.isToday
                                              }">
                                            {{ day.date.getDate() }}
                                        </span>
                                    </div>
                                    
                                    <!-- Events for this day -->
                                    <div class="relative z-10 space-y-1">
                                        <div *ngFor="let event of day.events; trackBy: trackByFn"
                                                 class="text-xs px-1.5 py-0.5 cursor-pointer hover:opacity-80 truncate transition-all duration-200 flex items-center justify-between gap-1 relative overflow-hidden"
                                             [ngClass]="{
                                                 'ring-2 ring-offset-1 ring-yellow-400 shadow-lg scale-105': isReservationSelected(event.reservation.id),
                                                 'hover:scale-102': !isReservationSelected(event.reservation.id),
                                                 'opacity-30': isPendingReservation(event.reservation),
                                                 'rounded-r': event.isStartDay && !event.isEndDay,
                                                 'rounded-l': event.isEndDay && !event.isStartDay,
                                                 'rounded': event.isMiddleDay || (event.isStartDay && event.isEndDay)
                                             }"
                                             [style.background-color]="event.color"
                                             [style.color]="'white'"
                                             [style.width]="(event.isStartDay && !event.isEndDay) ? 'calc(50% + 0.5rem)' : (event.isEndDay && !event.isStartDay) ? 'calc(50% + 0.5rem)' : '100%'"
                                             [style.margin-left]="(event.isStartDay && !event.isEndDay) ? 'auto' : '0'"
                                             [style.margin-right]="(event.isEndDay && !event.isStartDay) ? 'auto' : '0'"
                                                 [matTooltip]="event.reservation.propertyName + ' - ' + event.reservation.contactName"
                                             (click)="selectReservation(event.reservation.id, $event)">
                                            <span class="truncate flex-1">{{ event.reservation.propertyName }}</span>
                                            <span *ngIf="isReservationStartDay(day.date, event.reservation) && isPendingReservation(event.reservation)"
                                                  class="inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-semibold flex-shrink-0"
                                                  [ngClass]="getReservationStatusBadgeClass(event.reservation.status)">
                                                {{ getReservationStatusLabel(event.reservation.status) }}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>

                    <!-- Right Sidebar: Reservations List (Full width on mobile, sidebar on md+) -->
                    <div class="w-full md:w-full lg:w-96 xl:w-[450px] flex-shrink-0 bg-gray-50 dark:bg-gray-900 md:border-l border-gray-200 dark:border-gray-700 flex flex-col overflow-y-auto md:overflow-hidden">
                        <!-- Sidebar Header -->
                        <div class="p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white">
                                    Reservations
                                </h3>
                                <div class="flex items-center gap-2 px-3 py-1 bg-primary-100 dark:bg-primary-900/30 rounded-full">
                                    <mat-icon class="icon-size-4 text-primary-600" [svgIcon]="'heroicons_outline:calendar'"></mat-icon>
                                    <span class="text-sm font-bold text-primary-700 dark:text-primary-400">
                                        {{ getCurrentMonthReservations().length }}
                                    </span>
                                </div>
                            </div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">
                                {{ getMonthName() }} {{ currentYear }}
                            </p>
                        </div>

                        <!-- Reservations List -->
                        <div class="flex-auto md:overflow-y-auto p-4 sm:p-6 space-y-4">
                            <!-- No Reservations Message -->
                            <div *ngIf="getCurrentMonthReservations().length === 0" 
                                 class="flex flex-col items-center justify-center py-12 text-center">
                                <div class="w-16 h-16 rounded-full bg-gray-200 dark:bg-gray-800 flex items-center justify-center mb-4">
                                    <mat-icon class="icon-size-8 text-gray-400" [svgIcon]="'heroicons_outline:calendar'"></mat-icon>
                                </div>
                                <div class="text-lg font-medium text-gray-900 dark:text-white mb-1">No reservations</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                    No reservations scheduled for {{ getMonthName() }} {{ currentYear }}
                                </div>
                            </div>

                            <!-- Reservation Cards -->
                            <div #reservationCard
                                 *ngFor="let reservation of getCurrentMonthReservations(); trackBy: trackByFn"
                                 [attr.data-reservation-id]="reservation.id"
                                 class="group relative bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden cursor-pointer"
                                 [ngClass]="{
                                     'ring-4 ring-yellow-400 shadow-xl scale-105': isReservationSelected(reservation.id),
                                     'hover:scale-102': !isReservationSelected(reservation.id)
                                 }"
                                 (click)="selectReservation(reservation.id, $event)">
                                
                                <!-- Color Bar -->
                                <div class="absolute top-0 left-0 h-full transition-all duration-200" 
                                     [ngClass]="{
                                         'w-2': isReservationSelected(reservation.id),
                                         'w-1': !isReservationSelected(reservation.id)
                                     }"
                                     [style.background-color]="getColorForReservation(reservation.id)"></div>
                                
                                <!-- Card Content -->
                                <div class="p-4 transition-all duration-200"
                                     [ngClass]="{
                                         'pl-6': isReservationSelected(reservation.id),
                                         'pl-5': !isReservationSelected(reservation.id)
                                     }">
                                    
                                    <!-- Property Name with Color Badge and Action Buttons -->
                                    <div class="flex items-start justify-between mb-3">
                                        <div class="flex-1 min-w-0 pr-2">
                                            <div class="flex items-center gap-2 mb-1">
                                                <div class="w-3 h-3 rounded-full flex-shrink-0" 
                                                     [style.background-color]="getColorForReservation(reservation.id)"></div>
                                                <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 flex-shrink-0">
                                                    {{ reservation.propertyIdentifier || 'N/A' }}
                                                </span>
                                                <h4 class="font-semibold text-gray-900 dark:text-white truncate text-sm">
                                                    {{ reservation.propertyName || 'N/A' }}
                                                </h4>
                                            </div>
                                            <p class="text-xs text-gray-500 dark:text-gray-400 truncate">
                                                {{ reservation.propertyAddress || '' }}
                                            </p>
                                        </div>
                                        
                                        <!-- Status and Action Buttons - Top Right -->
                                        <div class="flex items-center gap-2 flex-shrink-0">
                                            <button mat-icon-button [matMenuTriggerFor]="statusMenu" [matTooltip]="'Change Status'" (click)="$event.stopPropagation()">
                                                <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:arrow-path'"></mat-icon>
                                            </button>
                                            <mat-menu #statusMenu="matMenu">
                                                <button mat-menu-item (click)="updateStatus(reservation, 0)">
                                                    <mat-icon class="text-yellow-500" [svgIcon]="'heroicons_outline:clock'"></mat-icon>
                                                    <span>Pending</span>
                                                </button>
                                                <button mat-menu-item (click)="updateStatus(reservation, 1)">
                                                    <mat-icon class="text-green-500" [svgIcon]="'heroicons_outline:check-circle'"></mat-icon>
                                                    <span>Approved</span>
                                                </button>
                                                <button mat-menu-item (click)="updateStatus(reservation, 3)">
                                                    <mat-icon class="text-gray-500" [svgIcon]="'heroicons_outline:ban'"></mat-icon>
                                                    <span>Cancelled</span>
                                                </button>
                                            </mat-menu>
                                            <span class="inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-semibold text-white"
                                                  [ngClass]="getReservationStatusBadgeClass(reservation.status)">
                                                <mat-icon *ngIf="getReservationStatusIcon(reservation.status)" 
                                                          class="icon-size-3" 
                                                          [svgIcon]="getReservationStatusIcon(reservation.status)"></mat-icon>
                                                {{ getReservationStatusLabel(reservation.status) }}
                                            </span>
                                            <button mat-icon-button [matTooltip]="'View'" color="primary" (click)="editReservation(reservation); $event.stopPropagation()">
                                                <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:eye'"></mat-icon>
                                            </button>
                                            <button mat-icon-button [matTooltip]="'Delete'" color="warn" (click)="deleteReservation(reservation, $event); $event.stopPropagation()">
                                                <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Tenant -->
                                    <div class="flex items-center gap-2 mb-3 p-2 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                                        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0">
                                            <mat-icon class="icon-size-4 text-white" [svgIcon]="'heroicons_outline:user'"></mat-icon>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <div class="text-sm font-medium text-gray-900 dark:text-white truncate">
                                                {{ reservation.contactName || 'N/A' }}
                                            </div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 truncate" *ngIf="reservation.contactEmail">
                                                {{ reservation.contactEmail }}
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Dates -->
                                    <div class="grid grid-cols-2 gap-4 mb-3">
                                        <!-- Entry -->
                                        <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500">
                                            <div class="flex items-center gap-1 mb-2">
                                                <mat-icon class="icon-size-4 text-green-600 dark:text-green-400" [svgIcon]="'heroicons_outline:arrow-right-circle'"></mat-icon>
                                                <span class="text-xs font-bold text-green-700 dark:text-green-300 uppercase tracking-wide">Entry</span>
                                            </div>
                                            <div class="text-base font-bold text-gray-900 dark:text-white mb-1">
                                                {{ reservation.startDate | date:'dd MMM yyyy' }}
                                            </div>
                                        </div>

                                        <!-- Departure -->
                                        <div class="p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border-l-4 border-red-500">
                                            <div class="flex items-center gap-1 mb-2">
                                                <mat-icon class="icon-size-4 text-red-600 dark:text-red-400" [svgIcon]="'heroicons_outline:arrow-left-circle'"></mat-icon>
                                                <span class="text-xs font-bold text-red-700 dark:text-red-300 uppercase tracking-wide">Departure</span>
                                            </div>
                                            <div class="text-base font-bold text-gray-900 dark:text-white mb-1">
                                                {{ reservation.endDate | date:'dd MMM yyyy' }}
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Price and Duration -->
                                    <div class="flex items-center justify-between pt-3 border-t border-gray-100 dark:border-gray-700">
                                        <div class="flex items-center gap-2">
                                            <div class="w-8 h-8 rounded-lg bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center">
                                                <mat-icon class="icon-size-4 text-purple-600 dark:text-purple-400" [svgIcon]="'heroicons_outline:moon'"></mat-icon>
                                            </div>
                                            <div>
                                                <div class="text-xs text-gray-500 dark:text-gray-400">Duration</div>
                                                <div class="text-sm font-bold text-gray-900 dark:text-white">
                                                    {{ reservation.numberOfNights || reservation.durationDays }} nights
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-xs text-gray-500 dark:text-gray-400">Total</div>
                                            <div class="text-lg font-bold text-primary-600 dark:text-primary-400">
                                                {{ reservation.totalAmount | number:'1.2-2' }} MAD
                                            </div>
                                        </div>
                                    </div>

                                </div>
                        </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Pagination (only for list view) -->
            <mat-paginator
                *ngIf="viewMode === 'list' && totalItems > 0"
                class="border-t flex-shrink-0"
                [length]="totalItems"
                [pageSize]="pageSize"
                [pageSizeOptions]="pageSizeOptions"
                [pageIndex]="currentPage - 1"
                [showFirstLastButtons]="true"
                (page)="onPageChange($event)">
            </mat-paginator>

        </div>

    </div>
