<div class="absolute inset-0 flex flex-col min-w-0 overflow-hidden">

    <!-- No Permission Message -->
    <div *ngIf="!canViewFileManager" class="flex flex-col items-center justify-center h-full p-8 bg-card dark:bg-transparent">
        <mat-icon class="icon-size-24 text-gray-400 mb-4" [svgIcon]="'heroicons_outline:lock-closed'"></mat-icon>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Access Denied</h2>
        <p class="text-gray-600 dark:text-gray-400 text-center max-w-md">
            You do not have permission to access file manager. Please contact your administrator to request access.
        </p>
    </div>

    <mat-drawer-container
        *ngIf="canViewFileManager"
        class="flex-auto h-full bg-card dark:bg-transparent"
        (backdropClick)="onBackdropClicked()">

        <!-- Drawer -->
        <mat-drawer
            *ngIf="hasSelectedItem"
            class="w-full sm:w-120 lg:w-140 xl:w-160 dark:bg-gray-900 shadow-2xl border-l border-gray-200 dark:border-gray-700 transition-all duration-300 ease-in-out"
            [mode]="drawerMode"
            [opened]="true"
            [position]="'end'"
            [disableClose]="false"
            (closed)="onDrawerClosed()"
            #matDrawer>
            <div class="h-full bg-white dark:bg-gray-900">
                <router-outlet></router-outlet>
            </div>
        </mat-drawer>

        <mat-drawer-content 
            class="flex flex-col bg-gray-100 dark:bg-transparent transition-all duration-300"
            [class.opacity-40]="hasSelectedItem"
            [class.backdrop-blur-sm]="hasSelectedItem"
            [class.brightness-75]="hasSelectedItem"
            (click)="onDrawerContentClicked($event); onMainContentClicked($event); onAnyClick($event)"
            (dragover)="onDragOver($event)"
            (dragenter)="onDragEnter($event)"
            (dragleave)="onDragLeave($event)"
            (drop)="onDrop($event)">

            <!-- Main -->
            <div class="flex flex-col flex-auto" (click)="onAnyClick($event)">

                <!-- Header -->
                <div class="flex flex-col sm:flex-row items-start sm:items-center sm:justify-between p-6 md:px-8 border-b bg-card dark:bg-transparent">
                    <!-- Title -->
                    <div>
                        <div class="text-4xl font-extrabold tracking-tight leading-none">{{ 'file_manager.title' | transloco }}</div>
                        <div class="flex items-center mt-0.5 font-medium text-secondary">
                            <ng-container *ngIf="!items.path.length">
                                {{ 'file_manager.count.folders' | transloco:{count: items.folders.length} }}, {{ 'file_manager.count.files' | transloco:{count: items.files.length} }}
                            </ng-container>
                            <!-- Breadcrumbs -->
                            <ng-container *ngIf="items.path.length">
                                <div class="flex items-center space-x-2">
                                    <a
                                        class="text-primary cursor-pointer"
                                        [routerLink]="['/gestionnaire-fichiers']">{{ 'file_manager.home' | transloco }}
                                    </a>
                                    <div class="">/</div>
                                    <ng-container *ngFor="let path of items.path; let last = last; trackBy: trackByFn">
                                        <ng-container *ngIf="!last">
                                            <a
                                                class="text-primary cursor-pointer"
                                                [routerLink]="['/gestionnaire-fichiers/folders/', encodeURIComponent(path.id)]">{{path.name}}</a>
                                        </ng-container>
                                        <ng-container *ngIf="last">
                                            <div>{{path.name}}</div>
                                        </ng-container>
                                        <ng-container *ngIf="!last">
                                            <div class="">/</div>
                                        </ng-container>
                                    </ng-container>
                                </div>
                            </ng-container>
                        </div>
                    </div>
                    <!-- Actions -->
                    <div class="mt-4 sm:mt-0">
                        <!-- Storage Usage Component -->
                        <app-storage-usage>
                        </app-storage-usage>
                    </div>
                </div>
                
                <!-- Search Bar -->
                <div class="p-6 md:px-8 bg-white dark:bg-gray-900 border-b">
                    <div class="flex gap-2 items-center">
                        <div class="flex-1 relative">
                            <mat-icon 
                                class="absolute left-3 top-1/2 transform -translate-y-1/2 text-hint"
                                [svgIcon]="'heroicons_solid:magnifying-glass'">
                            </mat-icon>
                            <input
                                class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"
                                type="text"
                                placeholder="Search files by name..."
                                [(ngModel)]="searchTerm"
                                (keyup.enter)="searchFiles()"
                                (input)="onSearchInputChange()">
                        </div>
                        <button
                            mat-flat-button
                            [color]="'primary'"
                            [disabled]="isLoading"
                            (click)="searchFiles()">
                            <mat-icon [svgIcon]="'heroicons_outline:magnifying-glass'"></mat-icon>
                            <span class="ml-2">Search</span>
                        </button>
                        <button
                            mat-stroked-button
                            [color]="'primary'"
                            [disabled]="isLoading"
                            (click)="refreshFiles()"
                            matTooltip="Refresh">
                            <mat-icon [svgIcon]="'heroicons_outline:arrow-path'"></mat-icon>
                        </button>
                        <button
                            *ngIf="isSearchActive"
                            mat-stroked-button
                            [color]="'warn'"
                            [disabled]="isLoading"
                            (click)="clearSearch()">
                            <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                            <span class="ml-2">Clear</span>
                        </button>
                    </div>
                    <div *ngIf="isSearchActive" class="mt-2 text-sm text-primary">
                        Showing search results for "{{ searchTerm }}" ({{ filteredItems?.files?.length || 0 }} files found)
                    </div>
                </div>

                <!-- Loading overlay for entire file manager -->
                <div *ngIf="isLoading" class="absolute inset-0 bg-white/80 dark:bg-gray-900/80 flex flex-col items-center justify-center z-50" [@fadeIn]>
                    <div class="mb-6 flex items-center justify-center">
                        <img 
                            src="assets/images/brand/loading.png" 
                            alt="Loading" 
                            class="w-1/2 h-auto">
                    </div>
                    <mat-spinner diameter="40" class="mb-2"></mat-spinner>
                    <div class="text-sm text-secondary">Processing...</div>
                </div>

                <!-- Drag and Drop Overlay -->
                <div 
                    class="absolute inset-0 bg-blue-500/20 dark:bg-blue-400/20 flex flex-col items-center justify-center z-40 border-4 border-dashed border-blue-500 dark:border-blue-400 transition-all duration-300"
                    [class.hidden]="!isDragOver"
                    (dragover)="onDragOver($event)"
                    (dragenter)="onDragEnter($event)"
                    (dragleave)="onDragLeave($event)"
                    (drop)="onDrop($event)">
                    <div class="flex flex-col items-center justify-center text-center">
                        <mat-icon class="icon-size-48 text-blue-500 dark:text-blue-400 mb-4" [svgIcon]="'heroicons_outline:arrow-up-tray'"></mat-icon>
                        <div class="text-2xl font-bold text-blue-600 dark:text-blue-300 mb-2">Drop files here to upload</div>
                        <div class="text-lg text-blue-500 dark:text-blue-400">Release to automatically upload files to this folder</div>
                        <div class="text-sm text-blue-400 dark:text-blue-500 mt-2">Files will be uploaded immediately after dropping</div>
                    </div>
                </div>

                <!-- Temporary folder header -->
                <div *ngIf="isInsideTemporaryFolder()" class="p-4 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <mat-icon class="text-yellow-600 mr-2" [svgIcon]="'heroicons_outline:exclamation-triangle'"></mat-icon>
                            <span class="text-yellow-800 dark:text-yellow-200 font-medium">You are inside a temporary folder</span>
                        </div>
                        <button
                            mat-flat-button
                            [color]="'warn'"
                            (click)="goBack()"
                            class="bg-yellow-500 hover:bg-yellow-600 text-white">
                            <mat-icon [svgIcon]="'heroicons_outline:arrow-left'"></mat-icon>
                            <span class="ml-2">Go Back</span>
                        </button>
                    </div>
                </div>

                <!-- Items list -->
                <ng-container *ngIf="(isSearchActive ? (filteredItems && filteredItems.files.length > 0) : (items && (items.folders.length > 0 || items.files.length > 0))); else noItems">
                    <div class="p-6 md:p-8 space-y-6">
                        <!-- Back button, Create Folder and Upload buttons (hide during search) -->
                        <div *ngIf="!isSearchActive" class="mb-4 flex gap-2 items-center justify-between">
                            <div class="flex gap-2">
                                <button
                                    mat-stroked-button
                                    [color]="'primary'"
                                    [disabled]="!items || !items.path || items.path.length === 0"
                                    (click)="goBack()">
                                    <mat-icon [svgIcon]="'heroicons_outline:arrow-left'"></mat-icon>
                                    <span class="ml-2">{{ 'file_manager.actions.back' | transloco }}</span>
                                </button>
                                
                                <!-- Special back button for temporary folders -->
                                <button
                                    *ngIf="isInsideTemporaryFolder()"
                                    mat-flat-button
                                    [color]="'warn'"
                                    (click)="goBack()"
                                    class="bg-yellow-500 hover:bg-yellow-600 text-white">
                                    <mat-icon [svgIcon]="'heroicons_outline:arrow-left'"></mat-icon>
                                    <span class="ml-2">Back from Temporary Folder</span>
                                </button>
                                <button
                                    *ngIf="canEditFileManager"
                                    mat-stroked-button
                                    [color]="'primary'"
                                    [disabled]="isLoading"
                                    (click)="createNewFolder()">
                                    <mat-icon *ngIf="!isLoading" [svgIcon]="'heroicons_outline:folder-plus'"></mat-icon>
                                    <mat-spinner *ngIf="isLoading" diameter="20" class="mr-2"></mat-spinner>
                                    <span class="ml-2">Create Folder</span>
                                </button>
                            </div>
                            
                            <!-- Upload and Multi-select buttons -->
                            <div class="flex gap-2">
                                <input
                                    #fileInput
                                    type="file"
                                    multiple
                                    class="hidden"
                                    (change)="onFileSelected($event); fileInput.value = ''"/>
                                <button
                                    *ngIf="canEditFileManager"
                                    mat-flat-button
                                    [color]="'primary'"
                                    [disabled]="isLoading"
                                    (click)="triggerFileInput()">
                                    <mat-icon *ngIf="!isLoading" [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                                    <mat-spinner *ngIf="isLoading" diameter="20" class="mr-2"></mat-spinner>
                                    <span class="ml-2 mr-1">{{ 'file_manager.upload_file' | transloco }}</span>
                                </button>
                                
                                <!-- Multi-select toggle button -->
                                <button
                                    *ngIf="canDeleteFileManager"
                                    mat-stroked-button
                                    [color]="'primary'"
                                    [disabled]="isLoading"
                                    (click)="toggleMultiSelectMode()"
                                    [class.bg-blue-100]="isMultiSelectMode">
                                    <mat-icon [svgIcon]="'heroicons_outline:check-circle'"></mat-icon>
                                    <span class="ml-2">Select</span>
                                </button>
                                
                                <!-- Bulk delete button (only show when files are selected) -->
                                <button
                                    *ngIf="canDeleteFileManager && isMultiSelectMode && selectedFilesCount > 0"
                                    mat-flat-button
                                    [color]="'warn'"
                                    [disabled]="isLoading"
                                    (click)="bulkDeleteSelectedFiles()">
                                    <mat-icon [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                    <span class="ml-2">Delete {{selectedFilesCount}} File(s)</span>
                                </button>
                                
                                <!-- Select all files button (only show in multi-select mode) -->
                                <button
                                    *ngIf="isMultiSelectMode && items.files.length > 0"
                                    mat-stroked-button
                                    [color]="'primary'"
                                    [disabled]="isLoading"
                                    (click)="selectAllFiles()">
                                    <mat-icon [svgIcon]="allFilesSelected ? 'heroicons_outline:x-mark' : 'heroicons_outline:check'"></mat-icon>
                                    <span class="ml-2">{{ allFilesSelected ? 'Deselect All Files' : 'Select All Files' }}</span>
                                </button>
                            </div>
                        </div>
                        <!-- Folders (hide during search) -->
                        <ng-container *ngIf="!isSearchActive && items.folders.length > 0">
                            <div>
                                <div class="font-medium">{{ 'file_manager.folders' | transloco }}</div>
                                <div
                                    class="flex flex-wrap -m-2 mt-2">
                                    <ng-container *ngFor="let folder of items.folders; trackBy:trackByFn">
                                        <div class="relative w-44 h-56 m-2 p-5 shadow rounded-2xl bg-card folder-item" data-folder-item="true" [class.border-2]="temporaryFolders.has(folder.id)" [class.border-yellow-500]="temporaryFolders.has(folder.id)">
                                            <!-- Delete button for temporary folders -->
                                            <button
                                                *ngIf="temporaryFolders.has(folder.id)"
                                                class="absolute z-20 top-1.5 right-1.5 w-8 h-8 min-h-8"
                                                (click)="deleteTemporaryFolder(folder.id)"
                                                mat-icon-button
                                                [matTooltip]="'Delete temporary folder'">
                                                <mat-icon
                                                    class="icon-size-5 text-red-500"
                                                    [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                            </button>
                                            <!-- Info button for permanent folders -->
                                            <a
                                                *ngIf="!temporaryFolders.has(folder.id)"
                                                class="absolute z-20 top-1.5 right-1.5 w-8 h-8 min-h-8"
                                                (click)="$event.preventDefault()"
                                                [routerLink]="['./details/', encodeURIComponent(folder.id)]"
                                                mat-icon-button>
                                                <mat-icon
                                                    class="icon-size-5"
                                                    [svgIcon]="'heroicons_solid:information-circle'"></mat-icon>
                                            </a>
                                            <a
                                                *ngIf="!temporaryFolders.has(folder.id)"
                                                class="z-10 absolute inset-0 flex flex-col p-4 cursor-pointer"
                                                [routerLink]="['/gestionnaire-fichiers/folders/', encodeURIComponent(folder.id)]">
                                                <div class="aspect-[9/6]">
                                                    <div class="flex items-center justify-center h-full">
                                                        <!-- Icon -->
                                                        <mat-icon
                                                            class="icon-size-14 text-hint opacity-50"
                                                            [svgIcon]="'heroicons_solid:folder'"></mat-icon>
                                                    </div>
                                                </div>
                                                <div class="flex flex-col flex-auto justify-center text-center text-sm font-medium mt-2">
                                                    <div
                                                        class="break-words leading-relaxed px-2 text-sm font-medium text-center overflow-hidden"
                                                        style="display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; max-height: 3.2em;"
                                                        [matTooltip]="folder.name">{{folder.name}}</div>
                                                    <ng-container *ngIf="folder.contents">
                                                        <div class="text-secondary truncate text-xs mt-1">{{folder.contents}}</div>
                                                    </ng-container>
                                                </div>
                                            </a>
                                            <!-- Temporary folder content (clickable) -->
                                            <div
                                                *ngIf="temporaryFolders.has(folder.id)"
                                                class="z-10 absolute inset-0 flex flex-col p-4 cursor-pointer"
                                                (click)="navigateToTemporaryFolder(folder.id)">
                                                <div class="aspect-[9/6]">
                                                    <div class="flex items-center justify-center h-full">
                                                        <!-- Icon -->
                                                        <mat-icon
                                                            class="icon-size-14 text-yellow-500 opacity-50"
                                                            [svgIcon]="'heroicons_solid:folder'"></mat-icon>
                                                    </div>
                                                </div>
                                                <div class="flex flex-col flex-auto justify-center text-center text-sm font-medium mt-2">
                                                    <div
                                                        class="break-words leading-relaxed px-2 text-sm font-medium text-center overflow-hidden"
                                                        style="display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; max-height: 3.2em;"
                                                        [matTooltip]="folder.name">{{folder.name}}</div>
                                                    <div class="text-yellow-600 dark:text-yellow-400 truncate text-xs mt-1">Temporary</div>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-container>
                                </div>
                            </div>
                        </ng-container>

                        <!-- Files -->
                        <ng-container *ngIf="(isSearchActive ? filteredItems.files.length > 0 : items.files.length > 0)">
                            <div>
                                <div class="font-medium">{{ 'file_manager.files' | transloco }}</div>
                                <div class="flex flex-wrap -m-2 mt-2">
                                    <ng-container *ngFor="let file of (isSearchActive ? filteredItems.files : items.files); trackBy:trackByFn">
                                         <div class="relative flex flex-col w-44 h-56 m-2 p-5 shadow rounded-xl bg-card transition-all duration-200 file-item"
                                             data-file-item="true"
                                             [ngClass]="{
                                                 'border-2 border-blue-500 bg-blue-50 dark:bg-blue-900/20': isMultiSelectMode && isFileSelected(file.id),
                                                 'hover:bg-gray-50 dark:hover:bg-gray-800': !isMultiSelectMode,
                                                 'cursor-pointer': !isMultiSelectMode
                                             }"
                                             [style.cursor]="!isMultiSelectMode ? 'pointer' : 'default'"
                                             (click)="isMultiSelectMode ? toggleFileSelection(file.id) : navigateToFile(file.id)"
                                             (mouseenter)="!isMultiSelectMode && setCursorPointer($event)"
                                             (mouseleave)="!isMultiSelectMode && resetCursor($event)">
                                            
                                            <!-- Selection checkbox (only in multi-select mode) -->
                                            <div *ngIf="isMultiSelectMode" 
                                                 class="absolute top-2 left-2 z-10"
                                                 (click)="$event.stopPropagation()">
                                                <mat-checkbox
                                                    [checked]="isFileSelected(file.id)"
                                                    (change)="toggleFileSelection(file.id)"
                                                    color="primary"
                                                    class="bg-white dark:bg-gray-800 rounded shadow-sm">
                                                </mat-checkbox>
                                            </div>
                                            
                                            <!-- File content (non-clickable in multi-select mode) -->
                                            <div class="flex flex-col h-full">
                                                <div class="aspect-[9/6]">
                                                    <!-- Image preview for image files -->
                                                    <div *ngIf="isImageFile(file) && file.url" class="flex items-center justify-center h-full relative">
                                                        <div class="relative">
                                                            <img 
                                                                [src]="file.url" 
                                                                [alt]="file.name"
                                                                class="w-16 h-16 object-cover rounded-lg"
                                                                (error)="$event.target.style.display='none'"
                                                                loading="lazy">
                                                            <!-- File type badge for images -->
                                                            <div
                                                                class="absolute left-0 bottom-0 px-1.5 py-0.5 rounded text-xs font-semibold leading-4 text-white"
                                                                [class.bg-amber-600]="file.type === 'JPG'"
                                                                [class.bg-purple-600]="file.type === 'PNG'"
                                                                [class.bg-orange-600]="file.type === 'GIF'"
                                                                [class.bg-blue-600]="file.type === 'WEBP'"
                                                                [class.bg-gray-600]="file.type === 'BMP'"
                                                                [class.bg-green-600]="file.type === 'SVG'">
                                                                {{file.type.toUpperCase()}}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- File icon for non-image files -->
                                                    <div *ngIf="!isImageFile(file) || !file.url" class="flex items-center justify-center h-full">
                                                        <div class="relative">
                                                            <mat-icon
                                                                class="icon-size-14 text-hint opacity-50"
                                                                [svgIcon]="getFileTypeIcon(file)"></mat-icon>
                                                            <div
                                                                class="absolute left-0 bottom-0 px-1.5 py-0.5 rounded text-xs font-semibold leading-4 text-white"
                                                                [class.bg-red-600]="file.type === 'PDF'"
                                                                [class.bg-blue-600]="file.type === 'DOC'"
                                                                [class.bg-green-600]="file.type === 'XLS'"
                                                                [class.bg-gray-600]="file.type === 'TXT'"
                                                                [class.bg-amber-600]="file.type === 'JPG'"
                                                                [class.bg-purple-600]="file.type === 'PNG'"
                                                                [class.bg-orange-600]="file.type === 'GIF'">
                                                                {{file.type.toUpperCase()}}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                 <div class="flex flex-col flex-auto justify-center text-center text-sm font-medium mt-2">
                                                     <fuse-filename-display
                                                         [filename]="file.name"
                                                         [maxLength]="50"
                                                         [truncateMode]="'none'"
                                                         [showExtension]="true"
                                                         cssClass="leading-relaxed px-2 text-sm font-medium">
                                                     </fuse-filename-display>
                                                    <ng-container *ngIf="file.contents">
                                                        <div class="text-secondary truncate text-xs mt-1">{{file.contents}}</div>
                                                    </ng-container>
                                                </div>
                                            </div>
                                            
                                            <!-- Selection overlay (only in multi-select mode) -->
                                            <div *ngIf="isMultiSelectMode && isFileSelected(file.id)" 
                                                 class="absolute inset-0 bg-blue-500/10 dark:bg-blue-400/10 rounded-2xl border-2 border-blue-500 dark:border-blue-400">
                                            </div>
                                        </div>
                                    </ng-container>
                                </div>
                            </div>
                        </ng-container>

                        <!-- Empty state for folders -->
                        <ng-container *ngIf="items.folders.length === 0 && items.files.length === 0 && items.path && items.path.length > 0">
                            <div class="flex flex-col items-center justify-center py-12">
                                <div class="w-24 h-24 mb-6 flex items-center justify-center">
                                    <mat-icon class="icon-size-24 text-hint opacity-50" [svgIcon]="'heroicons_outline:folder-open'"></mat-icon>
                                </div>
                                <div class="mt-4 text-xl font-semibold tracking-tight text-secondary">This folder is empty</div>
                                <div class="mt-2 text-sm text-secondary">Create a folder or upload files to get started</div>
                            </div>
                        </ng-container>
                    </div>
                </ng-container>

                <!-- No items template -->
                <ng-template #noItems>
                    <div class="flex flex-auto flex-col items-center justify-center bg-gray-100 dark:bg-transparent">
                        <!-- No-data content - hidden when loading -->
                        <div *ngIf="!isLoading" class="flex flex-col items-center justify-center text-center" [@zoomIn]>
                            
                            <!-- Search results empty state -->
                            <ng-container *ngIf="isSearchActive">
                                <div class="w-24 h-24 mb-6 flex items-center justify-center">
                                    <mat-icon class="icon-size-24 text-hint opacity-50" [svgIcon]="'heroicons_outline:magnifying-glass'"></mat-icon>
                                </div>
                                <div class="text-2xl font-semibold tracking-tight text-secondary mb-2">No files found</div>
                                <div class="text-sm text-secondary mb-6">No files match your search for "{{ searchTerm }}"</div>
                                
                                <!-- Clear search button -->
                                <div class="flex gap-4 items-center justify-center mb-8">
                                    <button
                                        mat-flat-button
                                        [color]="'primary'"
                                        (click)="clearSearch()">
                                        <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                                        <span class="ml-2">Clear Search</span>
                                    </button>
                                </div>
                            </ng-container>
                            
                            <!-- Normal empty state -->
                            <ng-container *ngIf="!isSearchActive">
                                <!-- Text content moved above image -->                                             
                                <div class="text-2xl font-semibold tracking-tight text-secondary mb-2">No files or folders yet</div>
                                <div class="text-sm text-secondary mb-6">Please upload files or create folders to get started</div>
                                
                                <!-- Action buttons for no-data state -->
                                <div class="flex gap-4 items-center justify-center mb-8">
                                    <button
                                        *ngIf="canEditFileManager"
                                        mat-stroked-button
                                        [color]="'primary'"
                                        [disabled]="isLoading"
                                        (click)="createNewFolder()">
                                        <mat-icon *ngIf="!isLoading" [svgIcon]="'heroicons_outline:folder-plus'"></mat-icon>
                                        <mat-spinner *ngIf="isLoading" diameter="20" class="mr-2"></mat-spinner>
                                        <span class="ml-2">Create Folder</span>
                                    </button>
                                    
                                    <input
                                        #fileInputNoData
                                        type="file"
                                        multiple
                                        accept="image/*, application/pdf, .doc, .docx, .xls, .xlsx, .txt"
                                        class="hidden"
                                        (change)="onFileSelected($event); fileInputNoData.value = ''"/>
                                    <button
                                        *ngIf="canEditFileManager"
                                        mat-flat-button
                                        [color]="'primary'"
                                        [disabled]="isLoading"
                                        (click)="triggerFileInput()">
                                        <mat-icon *ngIf="!isLoading" [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                                        <mat-spinner *ngIf="isLoading" diameter="20" class="mr-2"></mat-spinner>
                                        <span class="ml-2 mr-1">{{ 'file_manager.upload_file' | transloco }}</span>
                                    </button>
                                </div>
                                
                                <!-- Image moved below text and buttons, made smaller -->
                                <div class="flex items-center justify-center">
                                    <img 
                                        src="assets/images/brand/nodata.png" 
                                        alt="No data" 
                                        class="w-48 h-auto opacity-70">
                                </div>
                            </ng-container>
                        </div>
                    </div>
                </ng-template>

            </div>

        </mat-drawer-content>

    </mat-drawer-container>

</div>

<!-- Document Viewer -->
<app-document-viewer
    [documentType]="selectedDocumentType"
    [documentUrl]="selectedDocumentUrl"
    [documentName]="selectedDocumentName"
    [fileSize]="selectedFileSize"
    [isOpen]="isDocumentViewerOpen"
    (close)="closeDocumentViewer()">
</app-document-viewer>

<!-- PDF Viewer -->
<app-pdf-viewer
    [pdfUrl]="selectedPdfUrl"
    [pdfName]="selectedPdfName"
    [fileSize]="selectedPdfSize"
    [isOpen]="isPdfViewerOpen"
    (close)="closePdfViewer()">
</app-pdf-viewer>

<!-- Image Viewer -->
<app-image-viewer
    [imageUrl]="selectedImageUrl"
    [imageName]="selectedImageName"
    [fileSize]="selectedImageSize"
    [images]="selectedImages"
    [currentIndex]="selectedImageIndex"
    [isOpen]="isImageViewerOpen"
    (close)="closeImageViewer()"
    (imageChanged)="onImageChanged($event)">
</app-image-viewer>

<!-- Video Viewer -->
<app-video-viewer
    [videoUrl]="selectedVideoUrl"
    [videoName]="selectedVideoName"
    [fileSize]="selectedVideoSize"
    [isOpen]="isVideoViewerOpen"
    (close)="closeVideoViewer()">
</app-video-viewer>