<div class="absolute inset-0 flex flex-col min-w-0 overflow-hidden">

    <div class="flex flex-col h-full bg-card dark:bg-transparent">

        <!-- Main -->
        <div class="flex flex-col flex-auto overflow-hidden">
    
    <!-- Header -->
            <div class="flex flex-col py-6 px-6 md:px-8 border-b flex-shrink-0">

                <!-- Title Row -->
                <div class="mb-6">
                    <div class="text-4xl font-extrabold tracking-tight leading-none">Maintenance Requests</div>
                    <div class="ml-0.5 font-medium text-secondary">
                        <ng-container *ngIf="totalItems === 0">0 Total</ng-container>
                        <ng-container *ngIf="totalItems === 1">1 Total</ng-container>
                        <ng-container *ngIf="totalItems > 1">{{ totalItems }} Total</ng-container>
                    </div>
                </div>
                
                <!-- Search, View Toggle, and Add Button Row -->
                <div class="flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-4">
                    <!-- Left Side: Search with Clear Filters Button -->
                    <div class="flex items-center gap-2 flex-1 max-w-md">
                        <mat-form-field class="fuse-mat-dense fuse-mat-rounded flex-1" subscriptSizing="dynamic">
                            <mat-icon class="icon-size-5" matPrefix [svgIcon]="'heroicons_solid:magnifying-glass'"></mat-icon>
                            <input matInput [formControl]="searchControl" [autocomplete]="'off'" [placeholder]="'Search maintenance...'" />
                        </mat-form-field>
                        
                        <!-- Clear Filters Button -->
                        <button mat-stroked-button color="warn" *ngIf="hasActiveFilters() || searchControl.value"
                            (click)="clearAllFilters(); searchControl.setValue('')"
                            class="min-w-0 hidden sm:flex">
                            <mat-icon class="icon-size-5 mr-2" [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                            <span>Clear Filters</span>
                        </button>
                    </div>

                    <!-- Right Side: View Toggle and Add Button -->
                    <div class="flex items-center gap-4">
                        <!-- View toggle buttons -->
                        <mat-button-toggle-group [value]="viewMode" (change)="toggleViewMode($event.value)">
                            <mat-button-toggle value="list">
                                <mat-icon [svgIcon]="'heroicons_outline:list-bullet'"></mat-icon>
                                <span class="ml-2 hidden sm:inline">List</span>
                            </mat-button-toggle>
                            <mat-button-toggle value="grid">
                                <mat-icon [svgIcon]="'heroicons_outline:squares-2x2'"></mat-icon>
                                <span class="ml-2 hidden sm:inline">Grid</span>
                            </mat-button-toggle>
                        </mat-button-toggle-group>

                        <!-- Add maintenance button -->
                        <button mat-flat-button [color]="'primary'" (click)="addMaintenance()">
                            <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                            <span class="ml-2 mr-1">Add</span>
                    </button>
                    </div>
                </div>

            </div>

            <!-- Filters Section -->
            <div class="bg-white dark:bg-gray-800 border-b px-6 py-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Property Filter -->
                    <div class="relative">
                        <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-full" subscriptSizing="dynamic">
                            <mat-label>Property</mat-label>
                            <input matInput 
                                   type="text"
                                   [value]="isEditingProperty ? propertySearchTerm : getSelectedPropertyName()"
                                   (input)="onPropertyInput($event)"
                                   (focus)="onPropertyFocus()"
                                   (blur)="onPropertyBlur()"
                                   placeholder="Search properties..."
                                   autocomplete="off">
                            <mat-icon matPrefix class="icon-size-5" [svgIcon]="'heroicons_solid:building-office-2'"></mat-icon>
                            <button mat-icon-button matSuffix *ngIf="selectedPropertyId"
                                    (click)="clearPropertyFilter(); $event.stopPropagation()"
                                    class="icon-size-5">
                                <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                            </button>
                        </mat-form-field>
                        
                        <!-- Property Dropdown -->
                        <div *ngIf="showPropertyDropdown && filteredProperties.length > 0" 
                             class="absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                            <div class="px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-700"
                                 (mousedown)="selectProperty(null)">
                                <div class="font-medium text-gray-900 dark:text-white">All Properties</div>
                            </div>
                            <div *ngFor="let property of filteredProperties" 
                                 class="px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-700 last:border-b-0"
                                 (mousedown)="selectProperty(property.id)">
                                <div class="font-medium text-gray-900 dark:text-white">{{ property.name || property.identifier }}</div>
                                <div class="text-sm text-secondary" *ngIf="property.address">{{ property.address }}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Service Contact Filter -->
                    <div class="relative">
                        <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-full" subscriptSizing="dynamic">
                            <mat-label>Service Provider</mat-label>
                            <input matInput 
                                   type="text"
                                   [value]="isEditingContact ? contactSearchTerm : getSelectedContactName()"
                                   (input)="onContactInput($event)"
                                   (focus)="onContactFocus()"
                                   (blur)="onContactBlur()"
                                   placeholder="Search service providers..."
                                   autocomplete="off">
                            <mat-icon matPrefix class="icon-size-5" [svgIcon]="'heroicons_solid:wrench-screwdriver'"></mat-icon>
                            <button mat-icon-button matSuffix *ngIf="selectedContactId"
                                    (click)="clearContactFilter(); $event.stopPropagation()"
                                    class="icon-size-5">
                                <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                            </button>
                        </mat-form-field>
                        
                        <!-- Contact Dropdown -->
                        <div *ngIf="showContactDropdown && filteredServiceContacts.length > 0" 
                             class="absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                            <div class="px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-700"
                                 (mousedown)="selectContact(null)">
                                <div class="font-medium text-gray-900 dark:text-white">All Service Providers</div>
                            </div>
                            <div *ngFor="let contact of filteredServiceContacts" 
                                 class="px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-700 last:border-b-0"
                                 (mousedown)="selectContact(contact.id)">
                                <div class="font-medium text-gray-900 dark:text-white">
                                    {{ contact.isACompany ? contact.companyName : (contact.firstName + ' ' + contact.lastName) }}
                                </div>
                                <div class="text-sm text-secondary">{{ contact.email }}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Filter -->
                    <div class="relative">
                        <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-full" subscriptSizing="dynamic">
                            <mat-label>Status</mat-label>
                            <input matInput 
                                   type="text"
                                   [value]="getSelectedStatusLabel()"
                                   (focus)="toggleStatusDropdown()"
                                   readonly
                                   placeholder="Select status..."
                                   autocomplete="off">
                            <mat-icon matPrefix class="icon-size-5" [svgIcon]="'heroicons_solid:check-circle'"></mat-icon>
                            <button mat-icon-button matSuffix *ngIf="selectedStatus !== null"
                                    (click)="selectStatus(null); $event.stopPropagation()"
                                    class="icon-size-5">
                                <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                            </button>
                        </mat-form-field>
                        
                        <!-- Status Dropdown -->
                        <div *ngIf="showStatusDropdown" 
                             class="absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg"
                             (blur)="showStatusDropdown = false">
                            <div class="px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-700"
                                 (click)="selectStatus(null)">
                                <div class="font-medium text-gray-900 dark:text-white">All Statuses</div>
                            </div>
                            <div *ngFor="let status of statusOptions" 
                                 class="px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-700 last:border-b-0"
                                 (click)="selectStatus(status.value)">
                                <div class="flex items-center gap-2">
                                    <span class="flex-shrink-0 w-2 h-2 rounded-full" 
                                          [ngClass]="'bg-' + status.color + '-500'"></span>
                                    <span class="font-medium text-gray-900 dark:text-white">{{ status.label }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progress bar -->
            <mat-progress-bar *ngIf="isLoading" [mode]="'indeterminate'"></mat-progress-bar>

            <!-- Content -->
            <div class="flex flex-auto overflow-hidden">
                <div class="flex flex-col flex-auto">
                    
                    <!-- Scrollable Content Area -->
                    <div class="flex-auto overflow-y-auto">
                    
                    <!-- Grid View -->
                    <div *ngIf="viewMode === 'grid'" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-6">
                        <div *ngFor="let maintenance of maintenances; trackBy: trackByFn" 
                             class="flex flex-col shadow-lg rounded-2xl overflow-hidden hover:shadow-xl transition-shadow duration-300 border-2"
                             [ngClass]="{
                                'bg-green-50 dark:bg-green-900/30 border-green-400 dark:border-green-600': isStatusDone(maintenance.status),
                                'bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600': isStatusCancelled(maintenance.status),
                                'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700': !isStatusDone(maintenance.status) && !isStatusCancelled(maintenance.status)
                             }">
                            
                            <!-- Property Image -->
                            <div class="relative h-64"
                                 [ngClass]="{
                                    'bg-green-200 dark:bg-green-700': isStatusDone(maintenance.status),
                                    'bg-gray-200 dark:bg-gray-600': isStatusCancelled(maintenance.status),
                                    'bg-gray-200 dark:bg-gray-700': !isStatusDone(maintenance.status) && !isStatusCancelled(maintenance.status)
                                 }">
                                <img *ngIf="maintenance.propertyImageUrl" 
                                     class="w-full h-full object-cover" 
                                     [src]="maintenance.propertyImageUrl" 
                                     [alt]="maintenance.propertyName"
                                     onerror="this.src='assets/images/properties/default-property.png'">
                                <img *ngIf="!maintenance.propertyImageUrl && maintenance.propertyName" 
                                     class="w-full h-full object-cover" 
                                     [src]="'assets/images/properties/default-property.png'" 
                                     [alt]="maintenance.propertyName">
                                <div *ngIf="!maintenance.propertyImageUrl && !maintenance.propertyName" 
                                     class="w-full h-full flex items-center justify-center">
                                    <mat-icon class="icon-size-16 text-gray-400" [svgIcon]="'heroicons_outline:building-office-2'"></mat-icon>
                                </div>
                                
                                <!-- Priority Badge -->
                                <div class="absolute top-3 left-3">
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold text-white shadow-lg"
                                          [ngClass]="'bg-' + getMaintenancePriorityColor(maintenance.priority) + '-500'">
                                        {{ getMaintenancePriorityLabel(maintenance.priority) }}
                                    </span>
                                </div>
                            </div>

                            <!-- Content -->
                            <div class="flex flex-col flex-auto p-6">
                                <!-- Subject -->
                                <div class="text-lg font-semibold text-gray-900 dark:text-white mb-2 line-clamp-2">
                                    {{ maintenance.subject }}
                                </div>

                                <!-- Property Info -->
                                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:building-office-2'"></mat-icon>
                                    <span class="line-clamp-1">{{ maintenance.propertyName || 'N/A' }}</span>
                                    <span *ngIf="maintenance.propertyAddress" class="text-xs line-clamp-1">• {{ maintenance.propertyAddress }}</span>
                                </div>

                                <!-- Owner Info -->
                                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2" *ngIf="maintenance.ownerName || maintenance.ownerPhone">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:user'"></mat-icon>
                                    <span *ngIf="maintenance.ownerName" class="line-clamp-1">{{ maintenance.ownerName }}</span>
                                    <span *ngIf="maintenance.ownerName && maintenance.ownerPhone">•</span>
                                    <span *ngIf="maintenance.ownerPhone" class="line-clamp-1">{{ maintenance.ownerPhone }}</span>
                                </div>

                                <!-- Scheduled Date -->
                                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-4">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:calendar'"></mat-icon>
                                    <span>{{ maintenance.scheduledDateTime | date:'medium' }}</span>
                                </div>

                                <!-- Service Provider -->
                                <div class="flex items-center gap-3 p-3 rounded-lg mb-4"
                                     [ngClass]="{
                                        'bg-green-200 dark:bg-green-700/70': isStatusDone(maintenance.status),
                                        'bg-gray-200 dark:bg-gray-600': isStatusCancelled(maintenance.status),
                                        'bg-gray-50 dark:bg-gray-700': !isStatusDone(maintenance.status) && !isStatusCancelled(maintenance.status)
                                     }">
                                    <div class="flex-shrink-0">
                                        <div class="w-10 h-10 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center overflow-hidden">
                                            <mat-icon class="icon-size-6 text-gray-500" [svgIcon]="'heroicons_solid:wrench-screwdriver'"></mat-icon>
                                        </div>
                                    </div>
                                    <div class="flex-auto min-w-0">
                                        <div class="font-medium text-sm text-gray-900 dark:text-white truncate">
                                            {{ maintenance.contactName || 'N/A' }}
                                        </div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400 truncate" *ngIf="maintenance.contactEmail || maintenance.contactPhone">
                                            <span *ngIf="maintenance.contactEmail">{{ maintenance.contactEmail }}</span>
                                            <span *ngIf="maintenance.contactEmail && maintenance.contactPhone"> • </span>
                                            <span *ngIf="maintenance.contactPhone">{{ maintenance.contactPhone }}</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Description -->
                                <div *ngIf="maintenance.description" class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">
                                    {{ maintenance.description }}
                                </div>

                                <!-- Actions -->
                                <div class="flex items-center justify-between gap-2 pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center gap-3">
                                        <button mat-icon-button [matMenuTriggerFor]="statusMenu">
                                            <mat-icon [svgIcon]="'heroicons_outline:arrow-path'"></mat-icon>
                                        </button>
                                        
                                        <!-- Status Badge (Larger) -->
                                        <span class="px-4 py-2 rounded-full text-sm font-semibold text-white shadow-lg"
                                              [ngClass]="'bg-' + getMaintenanceStatusColor(maintenance.status) + '-500'">
                                            {{ getMaintenanceStatusLabel(maintenance.status) }}
                                        </span>
                                    </div>
                                    
                                    <mat-menu #statusMenu="matMenu">
                                        <button mat-menu-item (click)="updateStatus(maintenance, 1)">
                                            <mat-icon class="text-amber-500" [svgIcon]="'heroicons_outline:clock'"></mat-icon>
                                            <span>Waiting</span>
                                        </button>
                                        <button mat-menu-item (click)="updateStatus(maintenance, 2)">
                                            <mat-icon class="text-blue-500" [svgIcon]="'heroicons_outline:arrow-path'"></mat-icon>
                                            <span>In Progress</span>
                                        </button>
                                        <button mat-menu-item (click)="updateStatus(maintenance, 3)">
                                            <mat-icon class="text-green-500" [svgIcon]="'heroicons_outline:check-circle'"></mat-icon>
                                            <span>Done</span>
                                        </button>
                                        <button mat-menu-item (click)="updateStatus(maintenance, 4)">
                                            <mat-icon class="text-gray-500" [svgIcon]="'heroicons_outline:x-circle'"></mat-icon>
                                            <span>Cancelled</span>
                                        </button>
                                    </mat-menu>

                                    <div class="flex items-center gap-2">
                                        <button mat-icon-button (click)="editMaintenance(maintenance)" 
                                                [matTooltip]="'Edit'">
                                            <mat-icon [svgIcon]="'heroicons_outline:pencil'"></mat-icon>
                                        </button>
                                        <button mat-icon-button (click)="deleteMaintenance(maintenance)" 
                                                [matTooltip]="'Delete'" class="text-red-500">
                                            <mat-icon [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- List View -->
                    <div *ngIf="viewMode === 'list'" class="flex flex-col p-6 gap-4">
                        <div *ngFor="let maintenance of maintenances; trackBy: trackByFn" 
                             class="flex flex-col sm:flex-row shadow-lg rounded-xl overflow-hidden hover:shadow-xl transition-shadow duration-300 border-2"
                             [ngClass]="{
                                'bg-green-50 dark:bg-green-900/30 border-green-400 dark:border-green-600': isStatusDone(maintenance.status),
                                'bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600': isStatusCancelled(maintenance.status),
                                'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700': !isStatusDone(maintenance.status) && !isStatusCancelled(maintenance.status)
                             }">
                            
                            <!-- Property Image -->
                            <div class="relative sm:w-72 h-64 sm:h-auto flex-shrink-0"
                                 [ngClass]="{
                                    'bg-green-200 dark:bg-green-700': isStatusDone(maintenance.status),
                                    'bg-gray-200 dark:bg-gray-600': isStatusCancelled(maintenance.status),
                                    'bg-gray-200 dark:bg-gray-700': !isStatusDone(maintenance.status) && !isStatusCancelled(maintenance.status)
                                 }">
                                <img *ngIf="maintenance.propertyImageUrl" 
                                     class="w-full h-full object-cover" 
                                     [src]="maintenance.propertyImageUrl" 
                                     [alt]="maintenance.propertyName"
                                     onerror="this.src='assets/images/properties/default-property.png'">
                                <img *ngIf="!maintenance.propertyImageUrl && maintenance.propertyName" 
                                     class="w-full h-full object-cover" 
                                     [src]="'assets/images/properties/default-property.png'" 
                                     [alt]="maintenance.propertyName">
                                <div *ngIf="!maintenance.propertyImageUrl && !maintenance.propertyName" 
                                     class="w-full h-full flex items-center justify-center">
                                    <mat-icon class="icon-size-16 text-gray-400" [svgIcon]="'heroicons_outline:building-office-2'"></mat-icon>
                                </div>
                            </div>

                            <!-- Content -->
                            <div class="flex flex-col flex-auto p-6">
                                <div class="flex flex-col sm:flex-row sm:items-start justify-between gap-4 mb-4">
                                    <div class="flex-auto">
                                        <!-- Subject -->
                                        <div class="text-xl font-semibold text-gray-900 dark:text-white mb-2">
                                            {{ maintenance.subject }}
                                        </div>

                                        <!-- Property Info -->
                                        <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2">
                                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:building-office-2'"></mat-icon>
                                            <span>{{ maintenance.propertyName || 'N/A' }}</span>
                                            <span *ngIf="maintenance.propertyAddress" class="text-xs">• {{ maintenance.propertyAddress }}</span>
                                        </div>

                                        <!-- Owner Info -->
                                        <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2" *ngIf="maintenance.ownerName || maintenance.ownerPhone">
                                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:user'"></mat-icon>
                                            <span *ngIf="maintenance.ownerName">{{ maintenance.ownerName }}</span>
                                            <span *ngIf="maintenance.ownerName && maintenance.ownerPhone">•</span>
                                            <span *ngIf="maintenance.ownerPhone">{{ maintenance.ownerPhone }}</span>
                                        </div>

                                        <!-- Scheduled Date -->
                                        <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:calendar'"></mat-icon>
                                            <span>{{ maintenance.scheduledDateTime | date:'medium' }}</span>
                                        </div>
                                    </div>

                                    <!-- Priority Badge -->
                                    <div class="flex items-center gap-2">
                                        <span class="px-3 py-1 rounded-full text-xs font-semibold text-white"
                                              [ngClass]="'bg-' + getMaintenancePriorityColor(maintenance.priority) + '-500'">
                                            {{ getMaintenancePriorityLabel(maintenance.priority) }}
                                        </span>
                                    </div>
                                </div>

                                <!-- Service Provider -->
                                <div class="flex items-center gap-3 p-3 rounded-lg mb-3"
                                     [ngClass]="{
                                        'bg-green-200 dark:bg-green-700/70': isStatusDone(maintenance.status),
                                        'bg-gray-200 dark:bg-gray-600': isStatusCancelled(maintenance.status),
                                        'bg-gray-50 dark:bg-gray-700': !isStatusDone(maintenance.status) && !isStatusCancelled(maintenance.status)
                                     }">
                                    <div class="flex-shrink-0">
                                        <div class="w-10 h-10 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center overflow-hidden">
                                            <mat-icon class="icon-size-6 text-gray-500" [svgIcon]="'heroicons_solid:wrench-screwdriver'"></mat-icon>
                                        </div>
                                    </div>
                                    <div class="flex-auto min-w-0">
                                        <div class="font-medium text-sm text-gray-900 dark:text-white">
                                            {{ maintenance.contactName || 'N/A' }}
                                        </div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400" *ngIf="maintenance.contactEmail || maintenance.contactPhone">
                                            <span *ngIf="maintenance.contactEmail">{{ maintenance.contactEmail }}</span>
                                            <span *ngIf="maintenance.contactEmail && maintenance.contactPhone"> • </span>
                                            <span *ngIf="maintenance.contactPhone">{{ maintenance.contactPhone }}</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Description -->
                                <div *ngIf="maintenance.description" class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                                    {{ maintenance.description }}
                                </div>

                                <!-- Actions -->
                                <div class="flex items-center justify-between gap-2 pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center gap-3">
                                        <button mat-stroked-button [matMenuTriggerFor]="statusMenu">
                                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:arrow-path'"></mat-icon>
                                            <span class="ml-2">Change Status</span>
                                        </button>
                                        
                                        <!-- Status Badge (Larger) -->
                                        <span class="px-4 py-2 rounded-full text-sm font-semibold text-white shadow-lg"
                                              [ngClass]="'bg-' + getMaintenanceStatusColor(maintenance.status) + '-500'">
                                            {{ getMaintenanceStatusLabel(maintenance.status) }}
                                        </span>
                                    </div>
                                    
                                    <mat-menu #statusMenu="matMenu">
                                        <button mat-menu-item (click)="updateStatus(maintenance, 1)">
                                            <mat-icon class="text-amber-500" [svgIcon]="'heroicons_outline:clock'"></mat-icon>
                                            <span>Waiting</span>
                                        </button>
                                        <button mat-menu-item (click)="updateStatus(maintenance, 2)">
                                            <mat-icon class="text-blue-500" [svgIcon]="'heroicons_outline:arrow-path'"></mat-icon>
                                            <span>In Progress</span>
                                        </button>
                                        <button mat-menu-item (click)="updateStatus(maintenance, 3)">
                                            <mat-icon class="text-green-500" [svgIcon]="'heroicons_outline:check-circle'"></mat-icon>
                                            <span>Done</span>
                                        </button>
                                        <button mat-menu-item (click)="updateStatus(maintenance, 4)">
                                            <mat-icon class="text-gray-500" [svgIcon]="'heroicons_outline:x-circle'"></mat-icon>
                                            <span>Cancelled</span>
                                        </button>
                                    </mat-menu>

                                    <div class="flex items-center gap-2">
                                        <button mat-stroked-button (click)="editMaintenance(maintenance)">
                                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:pencil'"></mat-icon>
                                            <span class="ml-2">Edit</span>
                                        </button>
                                        <button mat-stroked-button color="warn" (click)="deleteMaintenance(maintenance)">
                                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                            <span class="ml-2">Delete</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- No data -->
                    <div *ngIf="!isLoading && maintenances.length === 0" class="flex flex-col items-center justify-center flex-auto min-h-96">
                        <app-no-data 
                            [message]="hasActiveFilters() || searchControl.value ? 'No maintenance requests found. Try adjusting your filters or search terms.' : 'No maintenance requests yet. Get started by creating your first maintenance request!'">
                        </app-no-data>
                    </div>

                    </div>
                    <!-- End Scrollable Content Area -->

                    <!-- Pagination - Fixed at Bottom -->
                    <div *ngIf="maintenances.length > 0" class="flex-shrink-0">
                        <mat-paginator
                            [length]="totalItems"
                            [pageSize]="pageSize"
                            [pageSizeOptions]="pageSizeOptions"
                            [pageIndex]="currentPage - 1"
                            (page)="onPageChange($event)"
                            class="border-t border-gray-200 dark:border-gray-700">
                        </mat-paginator>
                    </div>

                </div>
            </div>

        </div>

    </div>

</div>

